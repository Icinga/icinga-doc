<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter [
<!ENTITY % all.entities SYSTEM "all-entities.ent">
%all.entities;
]>
<section version="5.0" xml:id="quickstart-icinga" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"
         xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:svg="http://www.w3.org/2000/svg" xmlns:m="http://www.w3.org/1998/Math/MathML"
         xmlns:html="http://www.w3.org/1999/xhtml" xmlns:db="http://docbook.org/ns/docbook">
  <title>&name-icinga; - Démarrage rapide</title>

  <para><emphasis role="bold"><anchor xml:id="introduction_icinga" />Introduction</emphasis></para>

  <para>Ce guide a été rédigé pour vous permettre d'installer &name-icinga; à partir du code source, en suivant des instructions simples, afin de surveiller votre machine, le tout en 30 minutes.</para>

  <para>Aucune option avancée ne sera abordée ici, uniquement celles de base qui fonctionneront pour la majorité des utilisateurs.</para>

  <para>Ce tutoriel fournira des exemples de code pour trois distibutions Linux : <link
  xlink:href="http://fedoraproject.org/">&name-fedora;</link>, <link xlink:href="http://www.ubuntu.com/">&name-ubuntu;</link> et <link
  xlink:href="http://www.opensuse.org/">&name-opensuse;</link>. Il pourra être suivi sur des distributions similaires, telles que <link
  xlink:href="http://www.redhat.com/">&name-redhat;</link>, <link xlink:href="http://www.centos.org/">&name-centos;</link>, <link
  xlink:href="http://www.debian.org/">&name-debian;</link> et <link
  xlink:href="http://www.novell.com/products/server/">&name-sles;</link>.</para>

  <para>Toute autre distribution pourra s'inspirer de ces trois exemples.</para>

  <para><emphasis role="bold">Si vous prévoyez d'utiliser &name-icinga; avec &name-idoutils; merci de lire <xref
  linkend="quickstart-idoutils" /> à la place!</emphasis></para>

  <para><emphasis role="bold">Ce que vous obtiendrez!</emphasis></para>

  <para>Si vous suivez ces instructions, vous obtiendrez au final :</para>

  <itemizedlist>
    <listitem>
      <para>&name-icinga; et ses plugins qui seront installés sous l'arborescence &url-icinga-base;</para>
    </listitem>

    <listitem>
      <para>&name-icinga; sera configuré pour surveiller quelques parties de votre système local (charge CPU, espace disque, etc.)</para>
    </listitem>

    <listitem>
      <para>L'interface web calssique d'&name-icinga; qui sera accessible à l'adresse http://localhost/icinga/ ou http://yourdomain.com/icinga</para>
    </listitem>
  </itemizedlist>

  <para><emphasis role="bold">Pré-requis</emphasis></para>

  <para>Pendant certaines phases d'installation, vous aurez besoin d'un accès <emphasis role="bold">root</emphasis> à votre machine.</para>

  <itemizedlist>
    <listitem>
      <para>Apache</para>
    </listitem>

    <listitem>
      <para>Le compilateur GCC</para>
    </listitem>

    <listitem>
      <para>Les libraireis de développement C/C++</para>
    </listitem>

    <listitem>
      <para>Les librairies de développement <link xlink:href="http://www.boutell.com/gd/">GD</link></para>
    </listitem>
  </itemizedlist>


  <para><emphasis role="bold">Installer les paquets</emphasis></para>

  <para>Vous pouvez installer vos paquets en lancant les commandes suivantes (en tant que root ou sudo):</para>

  <para><emphasis role="bold">&name-fedora;/&name-rhel;/&name-centos;:</emphasis></para>

  <programlisting> #&gt; yum install httpd gcc glibc glibc-common gd gd-devel
 #&gt; yum install libjpeg libjpeg-devel libpng libpng-devel</programlisting>

  <para><emphasis role="bold">&name-debian;/&name-ubuntu;:</emphasis></para>

  <programlisting> #&gt; apt-get install apache2 build-essential libgd2-xpm-dev
 #&gt; apt-get install libjpeg62 libjpeg62-dev libpng12 libpng12-dev</programlisting>

  <note>
    <para>Les nombres &lt;62/12&gt; peuvent différer en fonction de votre distribution</para>
  </note>

  <para><emphasis role="bold">Créer un compte utilisateur</emphasis></para>

  <para>Passez en utilisateur root.</para>

  <programlisting> $&gt; su -l</programlisting>

  <para>Créez un compte utilisateur <emphasis>&name-icinga;</emphasis> et affectez-y un mot de passe.</para>

  <programlisting> #&gt; /usr/sbin/useradd -m icinga 
 #&gt; passwd icinga </programlisting>

  <para>Sur certaines distributions, vous devrez créer manuellement le groupe:</para>

  <programlisting> #&gt; /usr/sbin/groupadd icinga</programlisting>

  <para>Pour envoyer des commandes depuis l'interface web classique &name-icinga;, vous devez créer un coupe icinga-cmd. Ajoutez-y l'utilisateur web
  ainsi que l'utilisateur &name-icinga;:</para>

  <programlisting> #&gt; /usr/sbin/groupadd icinga-cmd
 #&gt; /usr/sbin/usermod -a -G icinga-cmd icinga
 #&gt; /usr/sbin/usermod -a -G icinga-cmd www-data (or www, wwwrun, apache en fonction de votre distribution)</programlisting>

  <note>
    <para>Certaines versions ne supportent pas l'option -a (comme OpenSuSE 11 et SLES 11). Dans ce cas omettez simplement l'option
    -a.</para>
  </note>

  <important>
    <para>Solaris ne supporte pas les groupes de plus de 8 charactères, utilisez icingcmd à la place de icinga-cmd.</para>
  </important>

  <para><emphasis role="bold">Télécharger &name-icinga; et les plugins</emphasis></para>

  <para>Changez de répertoire local pour /usr/src (par exemple)</para>

  <programlisting> #&gt; cd /usr/src</programlisting>

  <para>Récupérez la version actuelle de icinga-core depuis le dépôt GIT &name-icinga; <programlisting> #&gt; git clone git://git.icinga.org/icinga-core.git
 #&gt; git submodule init
 #&gt; git submodule update</programlisting> ou depuis le <link xlink:href="http://www.icinga.org/">site Internet &name-icinga;</link> . N'oubliez pas de télécharger
  les <link xlink:href="http://www.nagiosplugins.org/">plugins Nagios</link></para>

  <para><emphasis role="bold">Compiler et installer &name-icinga;</emphasis></para>

  <para>Décompressez le tarball du code source &name-icinga; (ou changez de répertoire dans le dépôt GIT)</para>

  <programlisting xml:space="preserve"> #&gt; cd /usr/src/ 
 #&gt; tar xvzf icinga-&ver-icinga;.tar.gz 
 #&gt; cd icinga-&ver-icinga;</programlisting>

  <note>
    <para>Ce chemin absolu nous servira de référence quand nous évoquerons '/path/to/icinga-src/' dans la suite de cette documentation.</para>
  </note>

  <para>Exécutez le script de configuration &name-icinga;. Vous pourrez consulter l'aide en ajoutant l'option --help:</para>

  <programlisting> #&gt; ./configure --with-command-group=icinga-cmd</programlisting>

  <important>
    <para>La compilation sous Solaris peut échouer en raison de dépendances instatisfaites au niveau la librairie gethostbyname. Dans ce cas, exécutez avant 
    la configuration:</para>

    <programlisting> #&gt; export LIBS=-lsocket -lnsl</programlisting>
  </important>

  <para><emphasis role="bold">Avec le cryptage SSL:</emphasis></para>

  <programlisting> #&gt; ./configure --with-command-group=icinga-cmd --enable-ssl</programlisting>

  <para><emphasis role="bold">Compiler and installer</emphasis></para>

  <para>Compiler le code source &name-icinga;. Pour avoir la liste des options disponibles utilisez "make".</para>

  <programlisting> #&gt; make all</programlisting>

  <para>Installer les binairies, init script, les fichiers de configuration d'exemple, et définir les persissions au dossier de commandes.
  <programlisting> #&gt; make install 
 #&gt; make install-init 
 #&gt; make install-config 
 #&gt; make install-commandmode</programlisting> ou plus court <programlisting> #&gt; make fullinstall</programlisting></para>

  <para>&name-icinga;-API sera installé durant "make install". Si vous devez l'installer manuellement, exécutez:
  <programlisting> #&gt; make install-api</programlisting>Cette opération est obligatoire pour Icinga-Web.</para>

  <para>Ne démarrez pas &name-icinga; pour le moment - il y a encore à faire avant que ce soit terminé...</para>

  <para><emphasis role="bold">Personnaliser la configuration</emphasis></para>

  <para>Les fichiers de configuration d'exemple ont été mis en place avec make install-config dans le répertoire &url-icinga-base;/etc/. 
   Vous n'avez qu'à modifier une petite chose avant d'utiliser &name-icinga;...</para>

  <para>Editez le fichier de configuration <emphasis>&url-icinga-base;/etc/objects/contacts.cfg</emphasis> avec votre éditeur favori et changez l'adresse
  email associée au contact <emphasis>icingaadmin</emphasis> qui sera utilisée pour vous envoyer les alertes.</para>

  <programlisting> #&gt; vi &url-icinga-base;/etc/objects/contacts.cfg</programlisting>

  <para><emphasis role="bold">Configurer l'interface Web classique</emphasis></para>

  <para>&name-icinga; est livré avec l'inteface web classique ("les CGIs") qui peut être installé par:</para>

  <programlisting> #&gt; make cgis
 #&gt; make install-cgis
 #&gt; make install-html</programlisting>

  <para>Si vous êtes interressés par la nouvalle interface Web &name-icinga;, référez-vous à  <link
      linkend="icinga-web-scratch">Installer la nouvelle interface Web 
  &name-icinga;</link> (documentation en anglais pour le moment).</para>

  <para>Installer la configuration l'interface Web classique d'&name-icinga; pour Apache dans le répertoire conf.d</para>

  <programlisting> #&gt; make install-webconf</programlisting>

  <para>Créez un compte <emphasis>icingaadmin</emphasis> pour vous identifier à l'interface Web classique &name-icinga;. Mémorisez le mot de passe que
  vous allez attribuer à ce compte - vous en aurez besoin ultérieurement.</para>

  <programlisting> #&gt; htpasswd -c &url-icinga-base;/etc/htpasswd.users icingaadmin</programlisting>

  <para>Pour changer le mot de passe d'un utilisateur existant ou rajouter un utilisateur, utilisez la commande:</para>

  <programlisting> #&gt; htpasswd &url-icinga-base;/etc/htpasswd.users &lt;USERNAME&gt;</programlisting>

  <note>
    <para>En fonction de votre distribution/version Apache, vous aurez peut-être à utiliser <emphasis>htpasswd2</emphasis> à la place.</para>
  </note>

  <para>Rechargez/rdémarrez Apache pour prendre en compte les modifications.</para>

  <para><emphasis role="bold">&name-fedora;/&name-rhel;/&name-centos;:</emphasis></para>

  <programlisting> #&gt; service httpd restart</programlisting>

  <para><emphasis role="bold">&name-ubuntu;/&name-opensuse;:</emphasis></para>

  <programlisting> #&gt; service apache2 restart</programlisting>

  <para><emphasis role="bold">&name-debian;:</emphasis></para>

  <programlisting> #&gt; /etc/init.d/apache2 reload</programlisting>

  <para><emphasis role="bold">Compiler and installer les plugins Nagios</emphasis></para>

  <para>Décompressze le code source des plugins Nagios du tarball.</para>

  <programlisting> #&gt; cd /usr/src 
 #&gt; tar xvzf nagios-plugins-&ver-nagiosplug;.tar.gz 
 #&gt; cd nagios-plugins-&ver-nagiosplug;  </programlisting>

  <para>Compilez and installez les plugins en changeant le répertoire d'installation de base vers &url-icinga-base;</para>

  <programlisting> #&gt; ./configure --prefix=&url-icinga-base; --with-cgiurl=/icinga/cgi-bin --with-htmurl=/icinga --with-nagios-user=icinga --with-nagios-group=icinga
 #&gt; make 
 #&gt; make install </programlisting>

  <para><emphasis role="bold">Ajuster les paramètres de SE&name-linux;</emphasis></para>

  <para>&name-rhel; et distributions dérivées comme &name-fedora; et &name-centos; sont fournies avec SE&name-linux; activé (Security Enhanced 
  &name-linux;) et fonctionnant en mode "forcé". Ceci peut mener à un message "Internal Server Error" lorsque vous essaierez d'appeller les CGI d'&name-icinga;.</para>

  <para>vérifiez si SE&name-linux; tourne en mode forcé</para>

  <screen> #&gt; getenforce</screen>

  <para>Paramétrez SE&name-linux; en mode "permissif"</para>

  <screen> #&gt; setenforce 0</screen>

  <para>Pour faire ce changement de manière permanente, vous devez modifier le paramètre dans <emphasis>/etc/selinux/config</emphasis> puis redémarrer le
  système.</para>

  <para>Au lieu de désactiver SE&name-linux; ou de le passer en mode permissif, vous pouvez lancer les commandes suivantes en mode "forcé":</para>

  <programlisting> #&gt; chcon -R -t httpd_sys_script_exec_t &url-icinga-base;/sbin/
 #&gt; chcon -R -t httpd_sys_content_t &url-icinga-base;/share/</programlisting>

  <para><emphasis role="bold">Démarrer &name-icinga;</emphasis></para>

  <para>Verifier la configuration d'&name-icinga;.</para>

  <programlisting> #&gt; &url-icinga-bin; -v &url-icinga-cfg; </programlisting>

  <para>S'il n'y a pas d'erreur, démarrez &name-icinga;.</para>

  <para><emphasis role="bold"> &name-fedora;/&name-rhel;/&name-centos;/&name-ubuntu;/&name-opensuse;:</emphasis></para>

  <programlisting> #&gt; service icinga start</programlisting>

  <para><emphasis role="bold">&name-debian;:</emphasis></para>

  <programlisting> #&gt; /etc/init.d/icinga start</programlisting>

  <para><emphasis role="bold">Configurer le démarrage d'&name-icinga;</emphasis></para>

  <para>Ajoutez &name-icinga; à la liste des services système et démarrez-le automatique au boot du système (assurez vous d'avoir installé les scripts d'init au préalable).</para>

  <para><emphasis role="bold">&name-fedora;/&name-rhel;/&name-centos;/&name-opensuse;:</emphasis></para>

  <programlisting> #&gt; chkconfig --add icinga chkconfig icinga on</programlisting>

  <para><emphasis role="bold">&name-debian;/&name-ubuntu;:</emphasis></para>

  <programlisting> #&gt; update-rc.d icinga defaults</programlisting>

  <para><emphasis role="bold">S'identifiez sur l'interface Web classique</emphasis></para>

  <para>Vous devriez maintenant être capable d'accéder à l'interface Web calssique d'&name-icinga; aux URL suivantes. Il vous sera demandé un nom d'utilisateur (
  <emphasis>icingaadmin</emphasis> ) et le mot de passe que vous avez renseigné. <programlisting> http://localhost/icinga/</programlisting> or
  <programlisting> http://yourdomain.com/icinga/ </programlisting></para>

  <para>Cliquez sur le menu "Service Detail" pour voir le détail des services surveillés sur la machine. Cela peut prendre quelques minutes
  à &name-icinga; pour procéder à la vérification de tous les services associés à la machine.</para>

  <para><emphasis role="bold">Autres modifications</emphasis></para>

  <para>Assurez-vous que votre firewall soit configuré pour accorder l'accès au serveur Web si vous souhaitez atteindre l'interface Web &name-icinga; à distance.</para>

  <programlisting> #&gt; iptables -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT</programlisting>

  <para>La configuration de votre mail transfer agent (MTA) comme exim, sendmail or postfix pour autoriser &name-icinga; à envoyer les emails de notificationending notification
  ne sera pas expliqué ici. Référezvous à <link xlink:href="http://www.nagioswiki.org/">&name-nagioswiki;</link> ipour plus d'informations.</para>

  <para><emphasis role="bold">C'est fini !</emphasis></para>

  <para>Félicitations! Vous venez d'installer &name-icinga;. Votre carrière de superviseur vient de commencer. Vous voudrez sans
  doute surveriller plus que votre machine, alors référez-vous au chapitre <link linkend="ch02">"Bien débuter"</link>
  à propos de la "Surveillance ..."</para>

  <indexterm zone="quickstart-icinga">
    <primary>Démarrage rapide</primary>

    <secondary>&name-icinga;</secondary>
  </indexterm>
</section>
