<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter [
<!ENTITY % all.entities SYSTEM "all-entities.ent">
%all.entities;
]>
<section version="5.0" xml:id="quickstart-idoutils" xmlns="http://docbook.org/ns/docbook"
         xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:svg="http://www.w3.org/2000/svg" xmlns:m="http://www.w3.org/1998/Math/MathML"
         xmlns:html="http://www.w3.org/1999/xhtml" xmlns:db="http://docbook.org/ns/docbook">
  <title>&name-icinga; with &name-idoutils; Quickstart</title>

  <para><emphasis role="bold"><anchor xml:id="introduction_idoutils" />Introduction</emphasis></para>

  <para>This guide is intended to provide you with simple instructions on how to install &name-icinga; from source (code) and have
  it monitoring your local machine within 30 minutes.</para>

  <para>No advanced installation options are discussed here - just the basics that will work for most of the users who want to get
  started.</para>

  <para>This guide will give you examples for currently three different Linux distributions: <link
  xlink:href="http://fedoraproject.org/">&name-fedora;</link>, <link xlink:href="http://www.ubuntu.com/">&name-ubuntu;</link> and
  <link xlink:href="http://www.opensuse.org/">&name-opensuse;</link>. Similar distributions may work as well. That should include
  <link xlink:href="http://www.redhat.com/">&name-redhat;</link>, <link xlink:href="http://www.centos.org/">&name-centos;</link>,
  <link xlink:href="http://www.debian.org/">&name-debian;</link> and <link
  xlink:href="http://www.novell.com/products/server/">&name-sles;</link>.</para>

  <para>Other distributions may inherit from these examples.</para>

  <para><emphasis role="bold">If you are planning to use &name-icinga; without &name-idoutils; please read <xref
  linkend="quickstart-icinga" /> instead!</emphasis></para>

  <para><emphasis role="bold">What You'll End Up With</emphasis></para>

  <para>If you follow these instructions, here's what you'll end up with:</para>

  <itemizedlist>
    <listitem>
      <para>&name-icinga; and the plugins will be installed underneath &url-icinga-base;</para>
    </listitem>

    <listitem>
      <para>&name-icinga; will be configured to monitor a few aspects of your local system (CPU load, disk usage, etc.)</para>
    </listitem>

    <listitem>
      <para>The &name-icinga; web interface will be accessible at http://localhost/icinga/ or http://yourdomain.com/icinga</para>
    </listitem>

    <listitem>
      <para>A database which is filled by &name-icinga; using &name-idoutils;</para>
    </listitem>
  </itemizedlist>

  <para><emphasis role="bold">Prerequisites</emphasis></para>

  <para>During portions of the installation you'll need to have <emphasis role="bold">root</emphasis> access to your
  machine.</para>

  <para>Make sure you've installed the following packages on your system before continuing. &name-idoutils; use the <link
  xlink:href="http://libdbi.sourceforge.net">libdbi</link> and the libdbi-drivers for several databases. The development libraries
  are also required. The following examples will show how to install the &name-idoutils; with the libdbi using &name-mysql; or
  &name-postgres;.</para>

  <itemizedlist>
    <listitem>
      <para>Apache</para>
    </listitem>

    <listitem>
      <para>GCC compiler</para>
    </listitem>

    <listitem>
      <para>C/C++ development libraries</para>
    </listitem>

    <listitem>
      <para><link xlink:href="http://www.boutell.com/gd/">GD</link> development libraries</para>
    </listitem>

    <listitem>
      <para>libdbi/libdbi-drivers, database like &name-mysql; or &name-postgres;</para>
    </listitem>
  </itemizedlist>

  <para><emphasis role="bold">New features for the &name-idoutils;:</emphasis></para>

  <para><emphasis role="bold">SSL- encryption between idomod and ido2db</emphasis></para>

  <para>If you want to use SSL-Encryption you'll need openssl and openssl-devel/libssl-dev (Ubuntu) to be installed !</para>

  <para><emphasis role="bold">Oracle Database Support</emphasis></para>

  <para>If you want Oracle as RDBM you'll need to install ocilib instead to libdbi. Get it from &url-orclib; and point configure to
  your Oracle libraries and header files e.g. from the Oracle instant client:</para>

  <para><programlisting> # ./configure --with-oracle-headers-path=/path/to/instantclient/sdk/include --with-oracle-lib-path=/path/to/instantclient/
 # make
 # make install</programlisting></para>

  <para><emphasis role="bold">Install packages</emphasis></para>

  <para>You can install your packages by running the following commands (as root or sudo):</para>

  <para><emphasis>&name-fedora;/&name-rhel;/&name-centos;:</emphasis></para>

  <programlisting> # yum install httpd gcc glibc glibc-common gd gd-devel
 # yum install libjpeg libjpeg-devel libpng libpng-devel</programlisting>

  <para><emphasis>&name-mysql;:</emphasis></para>

  <programlisting> # yum install mysql mysql-server libdbi libdbi-devel libdbi-drivers libdbi-dbd-mysql</programlisting>

  <para><emphasis>&name-postgres;:</emphasis></para>

  <programlisting> # yum install postgresql postgresql-server libdbi libdbi-devel libdbi-drivers libdbi-dbd-pgsql</programlisting>

  <para><emphasis>&name-debian;/&name-ubuntu;:</emphasis></para>

  <programlisting> # apt-get install apache2 build-essential libgd2-xpm-dev
 # apt-get install libjpeg62 libjpeg62-dev libpng12 libpng12-dev</programlisting>

  <note>
    <para>The numbers &lt;62/12&gt; might differ, depending on your distribution</para>
  </note>

  <para><emphasis>&name-mysql;:</emphasis></para>

  <programlisting> # apt-get install mysql-server mysql-client libdbi0 libdbi0-dev libdbd-mysql</programlisting>

  <para><emphasis>&name-postgres;:</emphasis></para>

  <programlisting> # apt-get install postgresql libdbi0 libdbi0-dev libdbd-pgsql</programlisting>

  <para><emphasis>&name-opensuse;:</emphasis></para>

  <para>Please use yast to install the necessary packages</para>

  <para><emphasis role="bold">Create Account Information</emphasis></para>

  <para>Become the root user.</para>

  <programlisting> # su -l</programlisting>

  <para>Create a new <emphasis>&name-icinga;</emphasis> user account and give it a password.</para>

  <programlisting> # /usr/sbin/useradd -m icinga 
 # passwd icinga </programlisting>

  <para>On some distributions you'll need to add the group in a single step:</para>

  <programlisting> # /usr/sbin/groupadd icinga</programlisting>

  <para><emphasis role="bold">Download &name-icinga; and the Plugins</emphasis></para>

  <para>Change to your local source directory i.e. /usr/src</para>

  <programlisting> # cd /usr/src</programlisting>

  <para>Either fetch the actual icinga-core snapshot from &name-icinga; GIT <programlisting> # git clone git://git.icinga.org/icinga-core.git  </programlisting>
  or from the <link xlink:href="http://www.icinga.org/">&name-icinga; Website</link> . Don't forget to download the <link
  xlink:href="http://www.nagios.org/">Nagios Plugins</link></para>

  <para><emphasis role="bold">Compile and Install &name-icinga; with &name-idoutils;</emphasis></para>

  <para>Extract the &name-icinga; source code tarball (or change directory to the GIT snapshot)</para>

  <programlisting xml:space="preserve"> # cd /usr/src/ 
 # tar xvzf icinga-&ver-icinga;.tar.gz 
 # cd icinga-&ver-icinga;</programlisting>

  <para>Run the &name-icinga; configure script and enable &name-idoutils;. You will get help by using the --help flag:</para>

  <programlisting> # ./configure --enable-idoutils</programlisting>

  <para><emphasis role="bold">With SSL-encryption:</emphasis></para>

  <programlisting> # ./configure --enable-idoutils --enable-ssl</programlisting>

  <para><emphasis role="bold">With Oracle database support:</emphasis></para>

  <para><programlisting> # ./configure --enable-idoutils --enable-oracle</programlisting> If you didn't install ocilib to the
  default path (/usr/local) you can point configure to the lib/inc directories:</para>

  <para><programlisting> # ./configure --enable-idoutils --enable-oracle --with-ocilib-lib=/path/to/ocilib/lib --with-ocilib-inc=/path/to/ocilib/include</programlisting><note>
      <para>If you want to change RDBM from Oracle to others, you need to recompile and reinstall &name-idoutils;!</para>
    </note><programlisting> # make distclean
 # ./configure --enable-idoutils</programlisting> Compile the &name-icinga; source code. There is also an extra option for
  &name-idoutils; (<emphasis>make idoutils</emphasis>) if you need to recompile only this module. To see available options, only
  use "make".</para>

  <programlisting> # make all</programlisting>

  <para>Install binaries, init script, sample config files and set permissions on the external command directory. Also install the
  &name-idoutils;. <programlisting> # make install 
 # make install-init 
 # make install-config 
 # make install-commandmode 
 # make install-idoutils </programlisting> or shorter <programlisting> # make fullinstall</programlisting></para>

  <para>Don't start &name-icinga; yet - there's still more that needs to be done...</para>

  <para><emphasis role="bold">Customize Configuration</emphasis></para>

  <para>Sample configuration files have been installed by using make install-config into &url-icinga-base;/etc/. You'll need to
  make just one change before you proceed...</para>

  <para>Edit the <emphasis>&url-icinga-base;/etc/objects/contacts.cfg</emphasis> config file with your favourite editor and change
  the email address associated with the <emphasis>icingaadmin</emphasis> contact definition to the address you'd like to use for
  receiving alerts.</para>

  <programlisting> # vi &url-icinga-base;/etc/objects/contacts.cfg</programlisting>

  <programlisting> # cd &url-icinga-base;/etc/
 # cp idomod.cfg-sample idomod.cfg
 # cp ido2db.cfg-sample ido2db.cfg</programlisting>

  <para>If you want to enable SSL-encryption and you configured the &name-idoutils; with ./configure --enable-ssl, you have to
  change idomod.cfg and ido2db.cfg: <programlisting> # use_ssl=1
 # socket_type=tcp </programlisting></para>

  <note>
    <para>If SSL is enabled in ido2db but not in the different idomod clients - data from those instances will be lost - that's
    guaranteed! SSL configuration has to be the same on all nodes!!!</para>
  </note>

  <para><emphasis>Enable the idomod event broker module:</emphasis></para>

  <para>Search for broker_module and uncomment the example or edit it matching your filenames in:</para>

  <programlisting> # vi &url-icinga-cfg;</programlisting>

  <para><emphasis role="bold">Creation of database and &name-idoutils;</emphasis></para>

  <para><emphasis role="bold">&name-mysql;:</emphasis></para>

  <para>Create Database, User, Grants:</para>

  <programlisting> # mysql -u root -p

 mysql&gt; CREATE DATABASE icinga;

 GRANT USAGE ON *.* TO 'icinga'@'localhost' IDENTIFIED BY 'icinga' WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0;

 GRANT SELECT , INSERT , UPDATE , DELETE ON icinga.* TO 'icinga'@'localhost';

 FLUSH PRIVILEGES ;

 quit</programlisting>

  <para>Import database scheme for &name-mysql;:</para>

  <programlisting> # cd /path/to/icinga-src/module/idoutils/db 
 # mysql -u root -p icinga &lt; mysql.sql</programlisting>

  <para>Edit the DB config file to customize &name-idoutils;</para>

  <!--  <link xlink:href="http://www.phpmyadmin.net">phpMyAdmin</link> -->

  <programlisting> # vi &url-icinga-base;/etc/ido2db.cfg

 db_servertype=mysql
 db_port=3306
 db_user=icinga
 db_pass=icinga</programlisting>

  <para><emphasis role="bold">&name-postgres;:</emphasis></para>

  <para>Create database and User:</para>

  <programlisting> # su - postgres
 $psql
 postgres=# CREATE USER icingauser;
 postgres=# ALTER USER icingauser WITH PASSWORD 'icingauser';
 postgres=# CREATE DATABASE icinga;
 </programlisting>

  <para><emphasis>&name-debian;:</emphasis></para>

  <programlisting> # vi /etc/postgresql/8.x/main/pg_hba.conf</programlisting>

  <para><emphasis>&name-fedora;/&name-rhel;/&name-centos;:</emphasis></para>

  <programlisting> # vi /var/lib/pgsql/data/pg_hba.conf</programlisting>

  <para>Edit the config e.g. like this (local user must be trusted)</para>

  <programlisting> # database administrative login by UNIX sockets
 local    all        postgres                  ident
 # TYPE   DATABASE   USER       CIDR-ADDRESS   METHOD 
 #icinga
 local    icinga     icingauser                trust
 # "local" is for Unix domain socket connections only
 local    all        all                       trust
 # IPv4 local connections
 local    all        all        127.0.0.1/32   trust
 # IPV6 local connections
 local    all        all        ::1/128        trust</programlisting>

  <para>Reload and configure database scheme.</para>

  <programlisting> # /etc/init.d/postgresql-8.x reload</programlisting>

  <programlisting> # cd /path/to/icinga-src/module/idoutils/db
 # psql -U icingauser -d icinga &lt; pgsql.sql</programlisting>

  <para>Edit the DB config file to customize &name-idoutils;</para>

  <programlisting> # vi /usr/local/icinga/etc/ido2db.cfg
 db_servertype=pgsql
 db_port=5432
 db_user=icingauser
 db_pass=icingauser</programlisting>

  <para><emphasis role="bold">Oracle:</emphasis></para>

  <para>Create a database schema and username/password (refer to the Oracle documentation at &url-oracle; or consult your DBA).
  Import the database scheme with sqlplus (or your preferred method). Copy module/idoutils/db/oracle.sql to $ORACLE_HOME</para>

  <programlisting> # su - oracle
 $ sqlplus dbuser/dbpass
 SQL&gt; @oracle.sql</programlisting>

  <para>Edit the DB config file to customize IDOUtils. Remember that Oracle ignores the db host, instead point db_name to
  //DBSERVER/DBNAME</para>

  <programlisting># vi /usr/local/icinga/etc/ido2db.cfg
  db_servertype=oracle
  db_port=1521
  db_user=icinga
  db_pass=icinga</programlisting>

  <para><emphasis role="bold">Configure the Web Interface</emphasis></para>

  <para>Install the &name-icinga; web config file in the Apache conf.d directory.</para>

  <programlisting> # make install-webconf</programlisting>

  <para>Create an <emphasis>icingaadmin</emphasis> account for logging into the &name-icinga; web interface. Remember the password
  you assign to this account - you'll need it later.</para>

  <programlisting> # htpasswd -c &url-icinga-base;/etc/htpasswd.users icingaadmin</programlisting>

  <para>To change the password of an existing user or to add a new user, take this command:</para>

  <programlisting> # htpasswd &url-icinga-base;/etc/htpasswd.users &lt;USERNAME&gt;</programlisting>

  <note>
    <para>Depending on your distribution/Apache-version you may have to use <emphasis>htpasswd2</emphasis> instead.</para>
  </note>

  <para>Reload/Restart Apache to make the new settings take effect.</para>

  <para><emphasis>&name-fedora;/&name-rhel;/&name-centos;:</emphasis></para>

  <programlisting> # service httpd restart</programlisting>

  <para><emphasis>&name-debian;/&name-ubuntu;/&name-opensuse;:</emphasis></para>

  <programlisting> # /etc/init.d/apache2 reload</programlisting>

  <para><emphasis role="bold">Compile and Install the Nagios Plugins</emphasis></para>

  <para>Extract the Nagios plugins source code tarball.</para>

  <programlisting> # cd /usr/src 
 # tar xvzf nagios-plugins-&ver-nagiosplug;.tar.gz 
 # cd nagios-plugins-&ver-nagiosplug;  </programlisting>

  <para>Compile and install the plugins by changing install directory to &url-icinga-base;</para>

  <programlisting> # ./configure --prefix=&url-icinga-base; --with-nagios-user=icinga 
 # make 
 # make install </programlisting>

  <para><emphasis role="bold">Start &name-idoutils; and &name-icinga;</emphasis></para>

  <para><emphasis><emphasis role="bold">Start &name-idoutils;</emphasis></emphasis></para>

  <para>&name-idoutils; must be started and running <emphasis>before</emphasis> &name-icinga; is started.</para>

  <para><emphasis>Start &name-idoutils;:</emphasis></para>

  <programlisting> # /etc/init.d/ido2db start</programlisting>

  <para><emphasis>Stop &name-idoutils;:</emphasis></para>

  <programlisting> # /etc/init.d/ido2db stop
</programlisting>

  <para>Verify the sample &name-icinga; configuration files.</para>

  <programlisting> #&url-icinga-bin; -v &url-icinga-cfg; </programlisting>

  <para>If there are no errors, start &name-icinga;.</para>

  <para><emphasis> &name-fedora;/&name-rhel;/&name-centos;:</emphasis></para>

  <programlisting> service icinga start</programlisting>

  <para><emphasis>&name-debian;/&name-ubuntu;/&name-opensuse;:</emphasis></para>

  <programlisting> # /etc/init.d/icinga start</programlisting>

  <para><emphasis role="bold">Configure &name-icinga; Startup</emphasis></para>

  <para>Add &name-icinga; to the list of system services and have it automatically start when the system boots (make sure you have
  installed the init script before).</para>

  <para><emphasis>&name-fedora;/&name-rhel;/&name-centos;/&name-opensuse;:</emphasis></para>

  <programlisting> # chkconfig --add icinga chkconfig icinga on</programlisting>

  <para><emphasis>&name-debian;/&name-ubuntu;:</emphasis></para>

  <programlisting> # update-rc.d icinga defaults</programlisting>

  <para><emphasis role="bold">Login to the Web Interface</emphasis></para>

  <para>You should now be able to access the &name-icinga; web interface at the URL below. You'll be prompted for the username (
  <emphasis>icingaadmin</emphasis> ) and password you specified earlier. <programlisting> http://localhost/icinga/</programlisting>
  or <programlisting> http://yourdomain.com/icinga/ </programlisting></para>

  <para>Click on the "Service Detail" navbar link to see details of what's being monitored on your local machine. It will take a
  few minutes for &name-icinga; to check all the services associated with your machine.</para>

  <para><emphasis role="bold">Other Modifications</emphasis></para>

  <para>Make sure your system's firewall rules are configured to allow access to the web server if you want to access the
  &name-icinga; interface remotely.</para>

  <programlisting> # iptables -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT</programlisting>

  <para>Setting up your mail transfer agent (MTA) like exim, sendmail or postfix to allow &name-icinga; sending notification
  emails won't be explained here. Please refer to the <link xlink:href="http://www.nagioswiki.org/">&name-nagioswiki;</link> for
  more resources.</para>

  <para>There are several tweaks for the &name-idoutils; (former NDOUtils of &name-nagios;) available.</para>

  <para><emphasis role="bold">You're Done</emphasis></para>

  <para>Congratulations! You successfully installed &name-icinga; with &name-idoutils;. Your journey into monitoring has just
  begun. You'll no doubt want to monitor more than just your local machine, so check out the chapter on <link
  linkend="ch02">"Getting Started"</link> about "Monitoring ..."</para>

  <indexterm zone="quickstart-idoutils">
    <primary>Quickstart &name-icinga; with &name-idoutils;</primary>
  </indexterm>
</section>
