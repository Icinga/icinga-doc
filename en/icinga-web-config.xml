<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section [
<!ENTITY % all.entities SYSTEM "all-entities.ent">
%all.entities;
]>
<section version="5.0" xml:id="icinga-web-config" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"
         xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:svg="http://www.w3.org/2000/svg" xmlns:m="http://www.w3.org/1998/Math/MathML"
         xmlns:html="http://www.w3.org/1999/xhtml" xmlns:db="http://docbook.org/ns/docbook">
  <title>Configuration Overview of &name-web;</title>

  <para><emphasis role="bold">Where are my config files? </emphasis></para>

  <para>We're trying to reduce global configuration files. Icinga operates in modules, every module has its own configuration. This is also
  done with the libraries. If you need information about the cronk library, take a look into <filename>app/modules/Cronks/lib</filename>
  (for js things <filename>app/modules/Cronks/lib/js</filename>).</para>

  <para>A sample module looks like this: <programlisting>tree -d -L 1 app/modules/AppKit/
app/modules/AppKit/
|-- actions
|-- config
|-- lib
|-- models
|-- templates
|-- validate
|-- views</programlisting></para>

  <para><emphasis role="bold">Index</emphasis></para>

  <itemizedlist>
    <listitem>
      <para><link linkend="configweb-globalconfig">Global Configuration Section</link></para>
    </listitem>

    <listitem>
      <para><link linkend="configweb-session-lifetime">Session Cookie Lifetime</link></para>
    </listitem>

    <listitem>
      <para><link linkend="configweb-timezone">Change default Timezone</link></para>
    </listitem>

    <listitem>
      <para><link linkend="configweb-module">Module Configuration</link></para>
    </listitem>

    <listitem>
      <para><link linkend="configweb-auth">Authentication</link></para>
    </listitem>

    <listitem>
      <para><link linkend="configweb-api">&name-api; connection</link></para>
    </listitem>

    <listitem>
      <para><link linkend="configweb-customconfig">Customised Configuration</link></para>
    </listitem>
  </itemizedlist>

  <para><anchor xml:id="configweb-globalconfig" /> <emphasis role="bold">Global Configuration Section</emphasis></para>

  <para><emphasis role="bold">app/config</emphasis></para>

  <para>Here you find the global configuration files for e.g. the Web session, the Icinga web path and the database information.</para>

  <para>The main interesting files:</para>

  <itemizedlist>
    <listitem>
      <para><filename>database.xml</filename> - holds the connection information for your icinga-web database</para>
    </listitem>

    <listitem>
      <para><filename>factories.xml</filename> - holds the config for your web session, e.g. the session_cookie_lifetime-parameter</para>
    </listitem>

    <listitem>
      <para><filename>icinga.xml</filename> - holds the config for your Icinga Web root-dir, Web path.</para>
    </listitem>
  </itemizedlist>

  <para><anchor xml:id="configweb-session-lifetime" /> <emphasis role="bold">Session Cookie Lifetime</emphasis></para>

  <para>Example: change the session_cookie_lifetime</para>

  <para>The Session Lifetime is the time in seconds until the Icinga Web session expires. It can be configured on global level in the file
  <filename>app/config/factories.xml</filename>.</para>

  <programlisting>#&gt; vi app/config/factories.xml
&lt;ae:parameter name="session_cookie_lifetime"&gt;3600&lt;/ae:parameter&gt;</programlisting>

  <para>Please make your customised settings in <filename>factories.site.xml</filename>.</para>

  <para><anchor xml:id="configweb-timezone" /> <emphasis role="bold">Change &name-web; timezone</emphasis></para>

  <para>Example: Change the default timezone for &name-web;</para>

  <para>If the time(zone) in &name-web; differs from your system time(zone), please check the date.timezone entry in
  <filename>app/modules/AppKit/config/module.xml</filename> (e.g. 'Europe/Berlin')</para>

  <programlisting>#&gt; vi app/modules/AppKit/config/module.xml
&lt;ae:parameter name="date.timezone"&gt;GMT&lt;/ae:parameter&gt;</programlisting>

  <para><anchor xml:id="configweb-module" /> <emphasis role="bold">Module Configuration</emphasis></para>

  <para><emphasis role="bold">app/modules/AppKit</emphasis></para>

  <para>Here lives the framework spun around: Authentication, Menus and so on.</para>

  <para><anchor xml:id="configweb-auth" /> <emphasis role="bold">Authentication</emphasis></para>

  <para>Example: LDAP authentication</para>

  <para>Look into <filename>app/modules/AppKit/config/auth.xml</filename>.</para>

  <para>There is a provider like this:</para>

  <programlisting> &lt;ae:parameter name="msad-ldap1"&gt;
            &lt;ae:parameter name="auth_module"&gt;AppKit&lt;/ae:parameter&gt;
            &lt;ae:parameter name="auth_provider"&gt;Auth.Provider.LDAP&lt;/ae:parameter&gt;
            &lt;ae:parameter name="auth_enable"&gt;true&lt;/ae:parameter&gt;
            &lt;ae:parameter name="auth_authoritative"&gt;true&lt;/ae:parameter&gt;
            &lt;ae:parameter name="auth_create"&gt;true&lt;/ae:parameter&gt;
            &lt;ae:parameter name="auth_update"&gt;true&lt;/ae:parameter&gt;

            &lt;ae:parameter name="auth_map"&gt;
                &lt;ae:parameter name="user_firstname"&gt;givenName&lt;/ae:parameter&gt;
                &lt;ae:parameter name="user_lastname"&gt;sn&lt;/ae:parameter&gt;
                &lt;ae:parameter name="user_email"&gt;mail&lt;/ae:parameter&gt; 
            &lt;/ae:parameter&gt;

            &lt;ae:parameter name="ldap_dsn"&gt;ldap://ad.icinga.org&lt;/ae:parameter&gt;
            &lt;ae:parameter name="ldap_basedn"&gt;DC=ad,DC=icinga,DC=org&lt;/ae:parameter&gt;
            &lt;ae:parameter name="ldap_binddn"&gt;ldap@AD.ICINGA.ORG&lt;/ae:parameter&gt;
            &lt;ae:parameter name="ldap_bindpw"&gt;&lt;![CDATA[XXXXXXXXX]]&gt;&lt;/ae:parameter&gt;
            &lt;ae:parameter name="ldap_userattr"&gt;uid&lt;/ae:parameter&gt;
            &lt;ae:parameter name="ldap_filter_user"&gt;&lt;![CDATA[(&amp;(sAmAccountName=__USERNAME__))]]&gt;&lt;/ae:parameter&gt;
        &lt;/ae:parameter&gt;</programlisting>

  <para>The <filename>auth.xml</filename> holds the documentation for the global config. The LDAP authentication should be done with some
  basic LDAP knowledge.</para>

  <para>You can also duplicate the provider to provide more authentication bases. You can split the auth into authentication and authorising
  parts if you want. If you have new providers, please share them and let the auth database grow!</para>

  <para>Please store your custom authentication configuration in <filename>auth.site.xml</filename> !</para>

  <para><emphasis role="bold">app/modules/Cronks</emphasis></para>

  <para>All the cronks are implemented there: Grids, iframes. All of them are simple html sites which hold ExtJS component codes. If you
  need to add a new cronk, this module is your friend.</para>

  <para>If you want to develop a new cronk take a look at <link
  xlink:href="https://dev.icinga.org/projects/icinga-development/wiki/HowToDevelopCronks">HowToDevelopCronks</link></para>

  <para>To change the configuration, go to the Cronks module.</para>

  <programlisting>#&gt; ls app/modules/Cronks/config
autoload.xml  config_handlers.xml  cronks.xml  module.xml  validators.xml</programlisting>

  <itemizedlist>
    <listitem>
      <para><filename>module.xml</filename> - to define new categories in which the cronks appears, module.xml holds all the
      information</para>
    </listitem>

    <listitem>
      <para><filename>cronks.xml</filename> - to make new cronks accessible or define new iframe cronks</para>
    </listitem>
  </itemizedlist>

  <para><emphasis role="bold">app/modules/Web</emphasis></para>

  <para>Or better:<emphasis role="bold"> Icinga</emphasis>. This module holds all Icinga related stuff, IcingaAPI2Json, status information.
  Also the IcingaAPI connection is configured here.</para>

  <para><anchor xml:id="configweb-api" /> <emphasis role="bold">&name-api; connection settings</emphasis></para>

  <para>Example: Change the IcingaApi connection settings</para>

  <para>Take a look at <filename>app/modules/Web/config/icinga-io.xml</filename>, here you'll find the default settings for the IcingaApi
  connection.</para>

  <programlisting>#&gt; vi app/modules/Web/config/icinga-io.xml

          &lt;setting name="api.interfaces.data"&gt;
                                        &lt;!-- IcingaApi connection interface --&gt;
                                        &lt;ae:parameter name="api_type"&gt;IcingaApi::CONNECTION_IDO&lt;/ae:parameter&gt;

                                        &lt;!-- Suits for all interfaes --&gt;
                                        &lt;ae:parameter name="config_type"&gt;mysql&lt;/ae:parameter&gt;
                                        &lt;ae:parameter name="config_host"&gt;localhost&lt;/ae:parameter&gt;
                                        &lt;ae:parameter name="config_port"&gt;3306&lt;/ae:parameter&gt;

                                        &lt;!-- ###BEGIN_CONNECTION_IDO### --&gt;
                                        &lt;!-- Database specific (IcingaApi::CONNECTION_IDO) --&gt;
                                        &lt;ae:parameter name="config_database"&gt;icinga&lt;/ae:parameter&gt;
                                        &lt;ae:parameter name="config_user"&gt;icinga&lt;/ae:parameter&gt;
                                        &lt;ae:parameter name="config_password"&gt;icinga&lt;/ae:parameter&gt;
                                        &lt;ae:parameter name="config_table_prefix"&gt;icinga_&lt;/ae:parameter&gt;
                                        &lt;!-- ###END_CONNECTION_IDO### --&gt;</programlisting>

  <para>If you want to change these settings to your needs, please edit
  <filename>app/modules/Web/config/icinga-io.site.xml</filename>.</para>

  <para><anchor xml:id="configweb-customconfig" /> <emphasis role="bold">Customised Configuration</emphasis></para>

  <para><emphasis role="bold">Notes</emphasis></para>

  <para>When creating and/or editing configuration files, keep the following in mind:</para>

  <orderedlist>
    <listitem>
      <para>Lines that start with a &lt;!-- and end with --&gt; character are taken to be comments and are not processed</para>
    </listitem>

    <listitem>
      <para>Variable names are case-sensitive</para>
    </listitem>

    <listitem>
      <para>Your specific &name-web; configuration settings like api, authentication and database settings can be set in
      app/modules/Appkit(/Cronks/Web)/config/*.site.xml files and will be used in the first place. They won't get overwritten during the
      next upgrade process.</para>

      <para>These files already exist and you're free to use them for your specific settings:</para>

      <para><filename>app/modules/Cronks/config/cronks.site.xml</filename></para>

      <para><filename>app/modules/Web/config/icinga-io.site.xml</filename></para>

      <para><filename>app/modules/AppKit/config/auth.site.xml</filename></para>

      <para><filename>app/config/icinga.site.xml</filename></para>

      <para><filename>app/config/databases.site.xml</filename></para>

      <para><filename>app/config/settings.site.xml</filename></para>

      <para><filename>app/config/translation.site.xml</filename></para>

      <para><filename>app/config/factories.site.xml</filename></para>

      <para></para>

      <para>The templates for Grids and TO's (tactical overview) are allowed to copy to *.site.xml in their location:</para>

      <para><emphasis role="bold">The Grids:</emphasis></para>

      <para><filename>app/modules/Cronks/data/xml/grid/icinga-hostgroup-summary-template.xml</filename></para>

      <para><filename>app/modules/Cronks/data/xml/grid/icinga-host-history-template.xml</filename></para>

      <para><filename>app/modules/Cronks/data/xml/grid/icinga-host-template.xml</filename></para>

      <para>...</para>

      <para><emphasis role="bold">and the TO's:</emphasis></para>

      <para><filename>app/modules/Cronks/data/xml/to/icinga-tactical-overview-groupstat.xml</filename></para>

      <para><filename>app/modules/Cronks/data/xml/to/icinga-tactical-overview-presets.xml</filename></para>

      <para><filename>app/modules/Cronks/data/xml/to/icinga-tactical-overview-template-charts.xml</filename></para>

      <para>...</para>

      <para>Please edit <filename>app/modules/Cronks/config/cronks.xml</filename> and add your created *.site.xml to make the new cronks
      accessible.</para>

      <para></para>
    </listitem>
  </orderedlist>

  <note>
    <para>After changing those configs you need to clear the config cache!</para>
  </note>

  <programlisting> #&gt; rm -rf app/cache/config/*.php</programlisting>

  <para>or</para>

  <programlisting> #&gt; /usr/local/icinga-web/bin/clearcache.sh</programlisting>

  <para>You need more information? Please have a look at our <link
  xlink:href="https://dev.icinga.org/projects/icinga-development/wiki/">Development Wiki.</link></para>

  <indexterm zone="icinga-web-config">
    <primary>&name-web;</primary>

    <secondary>Configuration Options</secondary>
  </indexterm>

  <indexterm zone="icinga-web-config">
    <primary>&name-web;</primary>

    <secondary>Customised Configuration</secondary>
  </indexterm>

  <indexterm zone="configweb-session-lifetime">
    <primary>&name-web;</primary>

    <secondary>Session Cookie Lifetime</secondary>
  </indexterm>

  <indexterm zone="configweb-module">
    <primary>&name-web;</primary>

    <secondary>Module configuration</secondary>
  </indexterm>

  <indexterm zone="configweb-auth">
    <primary>&name-web;</primary>

    <secondary>Authentication</secondary>
  </indexterm>

  <indexterm zone="configweb-api">
    <primary>&name-web;</primary>

    <secondary>&name-api; connection</secondary>
  </indexterm>

  <indexterm zone="configweb-timezone">
    <primary>&name-web;</primary>

    <secondary>Change default timezone</secondary>
  </indexterm>
</section>
