<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter [
<!ENTITY % all.entities SYSTEM "all-entities.ent">
%all.entities;
]>
<section version="5.0" xml:id="mrtggraphs" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"
         xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:svg="http://www.w3.org/2000/svg"
         xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:html="http://www.w3.org/1999/xhtml"
         xmlns:db="http://docbook.org/ns/docbook">
  <title><anchor xml:id="mrtg_graphs" />Graphing Performance Info With MRTG</title>

  <para><emphasis role="bold">Introduction</emphasis></para>

  <para>The <link linkend="icingastats">&name-stats;</link> utility allows you to graph various &name-icinga; performance
  statistics over time using <link xlink:href="http://oss.oetiker.ch/mrtg/">MRTG</link>. This is important because it can help
  you:</para>

  <itemizedlist>
    <listitem>
      <para>Ensure &name-icinga; is operating efficiently</para>
    </listitem>

    <listitem>
      <para>Locate problem areas in the monitoring process</para>
    </listitem>

    <listitem>
      <para>Observe the performance impacts of changes in your &name-icinga; configuration</para>
    </listitem>
  </itemizedlist>

  <para><emphasis role="bold">Sample MRTG Configuration</emphasis></para>

  <para>Sample MRTG configuration file snippets for graphing various &name-icinga; performance statistics can be found in the
  <emphasis>mrtg.cfg</emphasis> file located in the <emphasis>sample-config/</emphasis> subdirectory of the &name-icinga;
  distribution. You can create graphs of other performance information if you'd like - the samples just provide you with a good
  starting point.</para>

  <para>Once you copy these sample entries into your MRTG config file (/etc/mrtg/mrtg.cfg) you should have some new graphs the
  next time MRTG runs.</para>

  <para><emphasis role="bold">Example Graphs</emphasis></para>

  <para>We'll describe what a few of the sample MRTG graphs mean and what they can be used for...</para>

  <informaltable frame="none">
    <tgroup cols="2">
      <colspec colname="c1" colwidth="50*" />

      <colspec colname="c2" colwidth="50*" />

      <tbody>
        <row>
          <entry align="left" valign="top"><para> <emphasis role="bold">Active Host Checks</emphasis> - This graph shows how may
          active host checks (regularly scheduled and on-demand) have occurred over time. Useful for understanding:</para>
          <itemizedlist>
              <listitem>
                <para>
                  <link linkend="hostchecks">Host checks</link>
                </para>
              </listitem>

              <listitem>
                <para>
                  <link linkend="dependencychecks">Predictive host dependency checks</link>
                </para>
              </listitem>

              <listitem>
                <para>
                  <link linkend="cachedchecks">Cached checks</link>
                </para>
              </listitem>
            </itemizedlist></entry>

          <entry align="left" valign="top"><para> <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../images/mrtg-activehostchecks.png" format="PNG"></imagedata>
              </imageobject>
            </inlinemediaobject> </para></entry>
        </row>

        <row>
          <entry align="left" valign="top"><para> <emphasis role="bold">Active Service Checks</emphasis> - This graph shows how
          may active service checks (reguarly scheduled and on-demand) have occurred over time. Useful for understanding:</para>
          <itemizedlist>
              <listitem>
                <para>
                  <link linkend="servicechecks">Service checks</link>
                </para>
              </listitem>

              <listitem>
                <para>
                  <link linkend="dependencychecks">Predictive service dependency checks</link>
                </para>
              </listitem>

              <listitem>
                <para>
                  <link linkend="cachedchecks">Cached checks</link>
                </para>
              </listitem>
            </itemizedlist></entry>

          <entry align="left" valign="top"><para> <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../images/mrtg-activeservicechecks.png" format="PNG"></imagedata>
              </imageobject>
            </inlinemediaobject> </para></entry>
        </row>

        <row>
          <entry align="left" valign="top"><para> <emphasis role="bold">Cached Host and Service Checks</emphasis> - This graph
          shows how may cached host and service checks have occurred over time. Useful for understanding:</para> <itemizedlist>
              <listitem>
                <para>
                  <link linkend="cachedchecks">Cached checks</link>
                </para>
              </listitem>

              <listitem>
                <para>
                  <link linkend="dependencychecks">Predictive host and service dependency checks</link>
                </para>
              </listitem>
            </itemizedlist></entry>

          <entry align="left" valign="top"><para> <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../images/mrtg-cachedchecks.png" format="PNG"></imagedata>
              </imageobject>
            </inlinemediaobject> </para></entry>
        </row>

        <row>
          <entry align="left" valign="top"><para> <emphasis role="bold">Passive Host and Service Checks</emphasis> - This graph
          shows how may passive host and service checks have occurred over time. Useful for understanding:</para> <itemizedlist>
              <listitem>
                <para>
                  <link linkend="passivechecks">Passive checks</link>
                </para>
              </listitem>
            </itemizedlist></entry>

          <entry align="left" valign="top"><para> <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../images/mrtg-passivechecks.png" format="PNG"></imagedata>
              </imageobject>
            </inlinemediaobject> </para></entry>
        </row>

        <row>
          <entry align="left" valign="top"><para> <emphasis role="bold">Hosts/Services Actively Checked</emphasis> - This graph
          shows how many (of the total number of) hosts and services were <emphasis>last</emphasis> checked actively over time.
          Useful for understanding:</para> <itemizedlist>
              <listitem>
                <para>
                  <link linkend="activechecks">Active checks</link>
                </para>
              </listitem>
            </itemizedlist></entry>

          <entry align="left" valign="top"><para> <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../images/mrtg-activelychecked.png" format="PNG"></imagedata>
              </imageobject>
            </inlinemediaobject> </para></entry>
        </row>

        <row>
          <entry align="left" valign="top"><para> <emphasis role="bold">Hosts/Services Passively Checked</emphasis> - This graph
          shows how many (of the total number of) hosts and services were <emphasis>last</emphasis> checked passively over time.
          Useful for understanding:</para> <itemizedlist>
              <listitem>
                <para>
                  <link linkend="passivechecks">Passive checks</link>
                </para>
              </listitem>
            </itemizedlist></entry>

          <entry align="left" valign="top"><para> <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../images/mrtg-passivelychecked.png" format="PNG"></imagedata>
              </imageobject>
            </inlinemediaobject> </para></entry>
        </row>

        <row>
          <entry align="left" valign="top"><para> <emphasis role="bold">Average Service Check Latency and Execution
          Time</emphasis> - This graph shows average service check latency and execution times over time. Useful for
          understanding:</para> <itemizedlist>
              <listitem>
                <para>
                  <link linkend="servicechecks">Service checks</link>
                </para>
              </listitem>

              <listitem>
                <para>
                  <link linkend="tuning">Performance tuning</link>
                </para>
              </listitem>
            </itemizedlist> <para>Consistently high latencies can be an indication that one of more of the following variables
          need tweaking:</para> <itemizedlist>
              <listitem>
                <para>
                  <link linkend="configmain-max_concurrent_checks">max_concurrent_checks</link>
                </para>
              </listitem>

              <listitem>
                <para>
                  <link linkend="configmain-check_result_reaper_frequency">check_result_reaper_frequency</link>
                </para>
              </listitem>

              <listitem>
                <para>
                  <link linkend="configmain-max_check_result_reaper_time">max_check_result_reaper_time</link>
                </para>
              </listitem>
            </itemizedlist></entry>

          <entry align="left" valign="top"><para> <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../images/mrtg-serviceperfstats.png" format="PNG"></imagedata>
              </imageobject>
            </inlinemediaobject> </para></entry>
        </row>

        <row>
          <entry align="left" valign="top"><para> <emphasis role="bold">Average Service State Change</emphasis> - This graph shows
          the average percent state change (a measure of volatility) for services over time, broken down by services that were
          last checked either actively or passively. Useful for understanding:</para> <itemizedlist>
              <listitem>
                <para>
                  <link linkend="flapping">Flap detection</link>
                </para>
              </listitem>
            </itemizedlist></entry>

          <entry align="left" valign="top"><para> <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../images/mrtg-servicestatechange.png" format="PNG"></imagedata>
              </imageobject>
            </inlinemediaobject> </para></entry>
        </row>

        <row>
          <entry align="left" valign="top"><para> <emphasis role="bold">Average Host Check Latency and Execution Time</emphasis> -
          This graph shows average host check latency and execution times over time. Useful for understanding:</para>
          <itemizedlist>
              <listitem>
                <para>
                  <link linkend="hostchecks">Host checks</link>
                </para>
              </listitem>

              <listitem>
                <para>
                  <link linkend="tuning">Performance tuning</link>
                </para>
              </listitem>
            </itemizedlist> <para>Consistently high latencies can be an indication that one of more of the following variables
          need tweaking:</para> <itemizedlist>
              <listitem>
                <para>
                  <link linkend="configmain-max_concurrent_checks">max_concurrent_checks</link>
                </para>
              </listitem>

              <listitem>
                <para>
                  <link linkend="configmain-check_result_reaper_frequency">check_result_reaper_frequency</link>
                </para>
              </listitem>

              <listitem>
                <para>
                  <link linkend="configmain-max_check_result_reaper_time">max_check_result_reaper_time</link>
                </para>
              </listitem>
            </itemizedlist></entry>

          <entry align="left" valign="top"><para> <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../images/mrtg-hostperfstats.png" format="PNG"></imagedata>
              </imageobject>
            </inlinemediaobject> </para></entry>
        </row>

        <row>
          <entry align="left" valign="top"><para> <emphasis role="bold">Average Host State Change</emphasis> - This graph shows
          the average percent state change (a measure of volatility) for hosts over time, broken down by hosts that were last
          checked either actively or passively. Useful for understanding:</para> <itemizedlist>
              <listitem>
                <para>
                  <link linkend="flapping">Flap detection</link>
                </para>
              </listitem>
            </itemizedlist></entry>

          <entry align="left" valign="top"><para> <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../images/mrtg-hoststatechange.png" format="PNG"></imagedata>
              </imageobject>
            </inlinemediaobject> </para></entry>
        </row>

        <row>
          <entry align="left" valign="top"><para> <emphasis role="bold">External Commands</emphasis> - This graph shows how may
          external commands have been processed by the &name-icinga; daemon over time. Unless you're processing a large number of
          external commands (as in the case with distributed monitoring setups), this graph may appear mostly empty. Monitoring
          external commands can be useful for understanding the impacts of:</para> <itemizedlist>
              <listitem>
                <para>
                  <link linkend="passivechecks">Passive checks</link>
                </para>
              </listitem>

              <listitem>
                <para>
                  <link linkend="distributed">Distributed monitoring</link>
                </para>
              </listitem>

              <listitem>
                <para>
                  <link linkend="redundancy">Redundant/failover monitoring</link>
                </para>
              </listitem>
            </itemizedlist></entry>

          <entry align="left" valign="top"><para> <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../images/mrtg-externalcommands.png" format="PNG"></imagedata>
              </imageobject>
            </inlinemediaobject> </para></entry>
        </row>

        <row>
          <entry align="left" valign="top"><para> <emphasis role="bold">External Command Buffers</emphasis> - This graph shows how
          many external command buffer slots are in use over time. If the number of used buffers is near the number of available
          buffers on a regular basis, it is likely you need to increase the available <link
          linkend="configmain-external_command_buffer_slots">external command buffer slots</link>. Each buffer slot can hold one
          external command. Buffers are used for temporarily holding external commands from the time they are read from the <link
          linkend="configmain-command_file">external command file</link> to the time they are processed by the &name-icinga;
          daemon.</para></entry>

          <entry align="left" valign="top"><para> <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../images/mrtg-commandbuffers.png" format="PNG"></imagedata>
              </imageobject>
            </inlinemediaobject> </para></entry>
        </row>
      </tbody>
    </tgroup>
  </informaltable>
  <indexterm zone="mrtg_graphs"><primary>Graphing Performance Info With MRTG</primary></indexterm>
</section>
