<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter [
<!ENTITY % all.entities SYSTEM "all-entities.ent">
%all.entities;
]>
<section
version="5.0"
xml:id="icinga-web-scratch"
xmlns="http://docbook.org/ns/docbook"
xmlns:xlink="http://www.w3.org/1999/xlink"
xmlns:xi="http://www.w3.org/2001/XInclude"
xmlns:svg="http://www.w3.org/2000/svg"
xmlns:m="http://www.w3.org/1998/Math/MathML"
xmlns:html="http://www.w3.org/1999/xhtml"
xmlns:db="http://docbook.org/ns/docbook"
><title
>Installation &name-icinga; web frontend from scratch</title
><para
><emphasis
>Install icinga-web standalone from scratch</emphasis
></para
><orderedlist
><listitem
><para
><emphasis
role="bold"
>Voraussetzungen</emphasis
></para
><para
>Du hast mysql, php5 installiert (mit PEAR und CLI) . Icinga läuft und ebenfalls die IDOUtils, dann ab zu 2., ansonsten bitte:</para
><programlisting
># apt-get install php5-cli php-pear php5-xmlrpc php5-xsl</programlisting
><para
>Clone von icinga-web.git um mit der aktuellsten Version zu arbeiten:</para
><programlisting
># git clone git://git.icinga.org/icinga-web.git</programlisting
></listitem
><listitem
><para
><emphasis
role="bold"
>Die Installation</emphasis
></para
><programlisting
># tar xzvf icinga-web-(version).tar.gz
# cd icinga-web</programlisting
><para
>Nun kannst Du schon den Installer bemühen, mit :</para
><programlisting
># ./configure --help</programlisting
><para
>siehst Du alle Konfigurationsmöglichkeiten.</para
><para
>Ohne weitere Optionen wird das &name-icingaweb; unter /usr/local/icinga-web installiert:</para
><programlisting
># ./configure
# make install</programlisting
></listitem
><listitem
><para
><emphasis
role="bold"
>PHP- Anhängigkeiten</emphasis
></para
><para
>Bitte prüfe die PHP-Anhängigkeiten mit :</para
><programlisting
> # make testdeps</programlisting
><para
>Alle "require"-Test sollten erfolgreich sein. Eventuell mußt Du die php.ini anpassen:</para
><para
>Die "magic_quote_gpc" in der Apache und der Cli php.ini auf Off setzen!</para
><programlisting
># vi /etc/php5/apache/php.ini
  magic_quotes_gpc = off

# vi /etc/php5/cli/php.ini
  magic_quotes_gpc = off</programlisting
></listitem
><listitem
><para
><emphasis
role="bold"
>Datenbank anlegen</emphasis
></para
><para
><emphasis
role="bold"
>Manuelles Anlegen der Datenbank</emphasis
></para
><para
>Erstelle eine Datenbank und einen für SELECT, UPDATE, INSERT, DELETE auf diese Datenbank berechtigten User. Importiere etc/database/deploy/init.sql etc/database/deploy/db-deploy.sql in Deine Datenbank.</para
><para
><emphasis
role="bold"
>Anlegen mit Hilfe des Installers:</emphasis
></para
><para
>Gehe nach etc und kopiere die Datei build.properties (z.B. nach /tmp). Ändere die Datenbank-Einstellungen in  build.properties nach Deinen Vorstellungen . Führe phing aus:</para
><para
><programlisting
># /usr/local/icinga-web/bin/phing -Dproperties=/usr/local/icinga-web/build.properties db-initialize</programlisting
></para
><para
>Jetzt mußt Du noch einen DB-User anlegen (mit den Rechten  SELECT, UPDATE, INSERT, DELETE).</para
></listitem
><listitem
><para
><emphasis
role="bold"
>Icinga-Web Konfiguration</emphasis
></para
><para
>Anpassen der Konfiguration: Editiere /var/www/icinga-web/app/config/databases.xml und ändere die Datenbank-Einstellungen (ab Zeile 7, im Beispiel DB-User: icinga_user, PW: password):):<programlisting
>    &lt;database name="appkit_default" class="AgaviDoctrineDatabase"&gt;
       &lt;ae:parameter name="dsn"&gt;mysql://icinga_user:password@127.0.0.1:3306/icinga_web&lt;/ae:parameter&gt;
       &lt;ae:parameter name="username"&gt;icinga_user&lt;/ae:parameter&gt;
       &lt;ae:parameter name="password"&gt;password&lt;/ae:parameter&gt;
       &lt;ae:parameter name="charset"&gt;utf8&lt;/ae:parameter&gt;
       &lt;ae:parameter name="manager_attributes"&gt;
            <!-- This allows lazy loading of the models -->
          &lt;ae:parameter name="MODEL_LOADING"&gt;CONSERVATIVE&lt;/ae:parameter&gt;
       &lt;/ae:parameter&gt;
       &lt;ae:parameter name="load_models"&gt;%de.icinga.appkit.doctrine_model_path%&lt;/ae:parameter&gt;
    &lt;/database&gt;</programlisting
></para
><para
>Change the credentials for your database connection</para
><para
>Edit /var/www/icinga-web/app/config/icinga.xml and set database credentials to give access to ido-db (block should begin at line 163):</para
><programlisting
> &lt;parameter name="IcingaData"&gt;
     &lt;parameter name="class"&gt;IcingaData&lt;/parameter&gt;
     &lt;parameter name="api_file"&gt;%core.root_dir%/lib/icinga-api/IcingaApi.php&lt;/parameter&gt;
     &lt;parameter name="api_type"&gt;IcingaApi::CONNECTION_IDO&lt;/parameter&gt;
     &lt;parameter name="config_type"&gt;mysql&lt;/parameter&gt;
     &lt;parameter name="config_host"&gt;127.0.0.1&lt;/parameter&gt;

     &lt;parameter name="config_port"&gt;3306&lt;/parameter&gt;
     &lt;parameter name="config_database"&gt;icinga&lt;/parameter&gt;

     &lt;parameter name="config_user"&gt;your-ido-user&lt;/parameter&gt;
     &lt;parameter name="config_password"&gt;your-ido-pw&lt;/parameter&gt;

     &lt;parameter name="config_table_prefix"&gt;icinga_&lt;/parameter&gt;
 &lt;/parameter&gt;</programlisting
><note
> Please keep in mind that you have to install &name-idoutils; before (according to the <xref
linkend="quickstart-idoutils"
></xref
> ) </note
><para
>Go to the appkit.factories section and change the path and the credentials for the icinga-api.</para
><programlisting
>
 &lt;!-- icinga-api data interface --&gt;
                &lt;parameter name="IcingaData"&gt;
                        &lt;parameter name="class"&gt;IcingaData&lt;/parameter&gt;
                        &lt;parameter name="file"&gt;%core.module_dir%/Web/lib/icinga/factory/IcingaData.class.php &lt;/parameter&gt;

                         &lt;parameter name="requiredClasses"&gt;
                                &lt;!-- NONE --&gt;
                         &lt;/parameter&gt;

                         &lt;parameter name="api_file"&gt;%core.root_dir%/icinga-api/IcingaApi.php/&lt;parameter&gt;
                         &lt;parameter name="api_type"&gt;IcingaApi::CONNECTION_IDO&lt;/parameter&gt;

                         &lt;parameter name="config_type"&gt;mysql&lt;/parameter&gt;
                         &lt;parameter name="config_host"&gt;127.0.0.1&lt;/parameter&gt;


                         &lt;parameter name="config_port"&gt;3306&lt;/parameter&gt;
                         &lt;parameter name="config_database"&gt;icinga&lt;/parameter&gt;

                         &lt;parameter name="config_user"&gt;your-ido-user&lt;/parameter&gt;
                         &lt;parameter name="config_password"&gt;your-ido-pw&lt;/parameter&gt;

                         &lt;parameter name="config_table_prefix"&gt;icinga_&lt;/parameter&gt;
                &lt;/parameter&gt;</programlisting
></listitem
><listitem
><para
><emphasis
role="bold"
>Apache Konfiguration</emphasis
></para
><para
>Vorraussetzungen:</para
><para
>* mod_rewrite, vielleicht mußt Du einen Verweis erstellen:</para
><para
><programlisting
># ln -s /etc/apache2/mods-available/rewrite.load /etc/apache2/mods-enable/rewrite.load</programlisting
></para
><para
>* Any htaccess enabled alias settings</para
><para
>Ändere den Besitzer des http-Verzeichnisses::</para
><para
><programlisting
># chown -R www-data:www-data /usr/local/icinga-web</programlisting
></para
><para
>Editiere Deine icinga-web.conf:</para
><para
>Erstelle einen virtual host: <programlisting
> &lt;VirtualHost *:80&gt;

    ServerName icinga-web

    DocumentRoot /var/www/icinga-web/pub/

    DirectoryIndex index.php

    &lt;Directory /var/www/icinga-web/pub/&gt;
       Options -MultiViews -Indexes +FollowSymLinks
       AllowOverride none
       Order allow,deny
       Allow from all

       &lt;IfModule mod_rewrite.c&gt;
          RewriteEngine On
          RewriteBase /

          # If the requested URL does not exist (it's likely an agavi route),
          # pass it as path info to index.php, the Agavi dispatch script.
          RewriteRule ^$ index.php?/ [QSA,L]
          RewriteCond %{REQUEST_FILENAME} !-f
          RewriteCond %{REQUEST_FILENAME} !-d
          RewriteRule (.*) index.php?/$1 [QSA,L]
       &lt;/IfModule&gt;

    &lt;/Directory&gt;

    # deny something!
    &lt;Location /&gt;
       Options -MultiViews -Indexes +FollowSymLinks
       Order allow,deny
       Allow from all
    &lt;/Location&gt;

    # JS frameworks
    Alias /js/yui               /var/www/icinga-web/lib/yui
    Alias /js/swfobject         /var/www/icinga-web/lib/swfobject
    Alias /js/mootools          /var/www/icinga-web/lib/mootools
    Alias /js/jquery            /var/www/icinga-web/lib/jquery
    Alias /js/appkit            /var/www/icinga-web/lib/appkit/js
    Alias /js/gc-prettify       /var/www/icinga-web/lib/gc-prettify
    Alias /js/firebug           /var/www/icinga-web/lib/firebug
    Alias /js/ext3              /var/www/icinga-web/lib/ext3

    # Flash frameworks
    Alias /flash/flexchart      /var/www/icinga-web/lib/flexchart

    &lt;IfDefine APACHE2&gt;
       AcceptPathInfo On
    &lt;/IfDefine&gt;

 &lt;/VirtualHost&gt;</programlisting
></para
><para
>Bitte passe noch Deine .htaccess- Datei unter dem pub-Verzeichnis an. </para
><para
><programlisting
># vi /usr/local/icinga-web/pub/.htaccess
  RewriteBase /icinga-web/</programlisting
></para
><para
>Leere den Cache:</para
><para
><programlisting
># rm /usr/local/icinga-web/app/cache/config/*.php</programlisting
></para
><para
>Und starte Deinen Webserver neu:</para
><para
><programlisting
># service apache2 restart</programlisting
></para
></listitem
><listitem
><para
><emphasis
role="bold"
>Teste </emphasis
></para
><para
><emphasis
role="bold"
>Bitte achte darauf mysql, apache, idoutils and icinga müssen gestartet sein!</emphasis
></para
><para
>Öffne in Deinem Webbrowser: http://localhost/icinga-web und logge Dich mit dem User 'root' und dem Passwort 'password' ein. Viel Spaß beim Entdecken....wir freuen uns auf Dein Feedback.</para
></listitem
></orderedlist
></section
>
