<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section [
<!ENTITY % all.entities SYSTEM "all-entities.ent">
%all.entities;
]>
<section version="5.0" xml:id="icinga-web-scratch" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"
         xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:svg="http://www.w3.org/2000/svg" xmlns:m="http://www.w3.org/1998/Math/MathML"
         xmlns:html="http://www.w3.org/1999/xhtml" xmlns:db="http://docbook.org/ns/docbook">
  <title>Installation des &name-web; Frontend</title>

  <para><emphasis role="bold">Einleitung</emphasis></para>

  <para>Das neue &name-web; wird aktuell sehr stark weiterentwickelt, sodass sich diese Dokumentation unter Umständen noch ändern kann/wird.
  Falls Sie eine detaillierte Installationsanleitung benötigen, konsultieren Sie bitte <filename>doc/INSTALL</filename> aus dem
  Source-Paket. Mehr Informationen über die gesamte Architektur können Sie auf unserer Webseite nachlesen: <link
  xlink:href="http://www.icinga.org/architecture/">&url-icinga;architecture/</link> Falls Sie mehr über das &name-web;-Development und die
  Modularchitektur wissen wollen, verfolgen Sie bitte stetig aktualisierte Einträge im Development-Wiki von &name-web;: <link
  xlink:href="https://dev.icinga.org/projects/icinga-development/wiki#24-Icinga-Web">&name-icingawiki;</link></para>

  <para>Diese Installationsanleitung beschreibt die Installation von &name-web; mit &name-mysql; bzw. &name-postgres; als verwendeter
  Datenbank, außerdem wird &name-oracle; unterstützt.</para>

  <orderedlist>
    <listitem>
      <para><emphasis role="bold">Voraussetzungen</emphasis></para>

      <itemizedlist>
        <listitem>
          <para><emphasis role="bold">&name-mysql;</emphasis></para>

          <para>Die Pakete mysql und php5 sind installiert (mit PEAR und CLI), &name-icinga; samt IDOUtils läuft, dann ab zu 2., ansonsten
          bitte:</para>

          <itemizedlist>
            <listitem>
              <para><emphasis role="bold">Ubuntu / Debian</emphasis></para>

              <programlisting> #&gt; apt-get install php5 php5-cli php-pear php5-xmlrpc php5-xsl php5-pdo php5-ldap php5-soap php5-gd php5-mysql</programlisting>

              <note>
                <para>Für &name-ubuntu; gibt es kein php5-pdo-Paket, die benötigten PDO-Extensions sind in den Paketen php5 und php5-mysql
                enthalten!</para>
              </note>
            </listitem>

            <listitem>
              <para><emphasis role="bold">Fedora / RHEL / CentOS</emphasis></para>

              <para>Stellen Sie sicher, dass Sie ein Repository bzw. Pakete für PHP 5.2.3 und PCRE 7.6 haben - RHEL/CentOS &lt;= 5.x
              enthalten bisher lediglich PHP 5.1.6 und PCRE 6.6.</para>

              <para><programlisting> #&gt; yum install php php-cli php-pear php-xmlrpc php-xsl php-pdo php-ldap php-soap php-gd php-mysql</programlisting></para>

              <note>
                <para>Aktuelle Pakete für PHP und PRCE finden Sie beispielsweise unter: <link
                xlink:href="http://blog.famillecollet.com/pages/Config-en">Les RPM de Remi</link> oder <link
                xlink:href="http://www.jasonlitka.com/category/yum-repo-news">http://www.jasonlitka.com/category/yum-repo-news/</link></para>
              </note>
            </listitem>

            <listitem>
              <para><emphasis role="bold">OpenSuSE</emphasis></para>

              <para>Benutzen Sie yast, um die Pakete "php5", "php5-pear", "php5-xmlrpc", "php5-xsl", "php5-mysql", "php5-soap",
              "php5-gettext", "php5-pdo", "php5-ldap", "php5-gd" und "apache2-mod_php5" zu installieren. Die CLI ist im php5-Paket
              enthalten.</para>

              <note>
                <para>Zumindest bei SLES10 SP2 fehlt die Funktion hash_hmac.</para>
              </note>

              <para>Alternativ können Sie auch zypper verwenden</para>

              <programlisting> #&gt; zypper install php5 php5-pear php5-xmlrpc php5-xsl php5-mysql php5-soap \
    php5-gettext php5-pdo php5-ldap php5-gd apache2-mod_php5</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para><emphasis role="bold">&name-postgres;</emphasis></para>

          <para>Die Pakete pgsql und php5 sind installiert (mit PEAR und CLI), &name-icinga; samt IDOUtils läuft, dann ab zu 2., ansonsten
          bitte:</para>

          <itemizedlist>
            <listitem>
              <para><emphasis role="bold">Ubuntu / Debian</emphasis></para>

              <programlisting> #&gt; apt-get install php5 php5-cli php-pear php5-xmlrpc php5-xsl php5-pdo php5-ldap php5-gd php5-pqsql</programlisting>

              <note>
                <para>Für &name-ubuntu; gibt es kein php5-pdo-Paket, die benötigten PDO-Extensions sind in den Paketen php5 und php5-pqsql
                enthalten!</para>
              </note>
            </listitem>

            <listitem>
              <para><emphasis role="bold">Fedora / RHEL / CentOS</emphasis></para>

              <para>Stellen Sie sicher, dass Sie ein Repository bzw. Pakete für PHP 5.2.3 und PCRE 7.6 haben - RHEL/CentOS &lt;= 5.x
              enthalten bisher lediglich PHP 5.1.6 und PCRE 6.6.</para>

              <para><programlisting> #&gt; yum install php php-cli php-pear php-xmlrpc php-xsl php-pdo php-ldap php-gd php-pqsql</programlisting></para>

              <note>
                <para>Aktuelle Pakete für PHP und PRCE finden Sie beispielsweise unter: <link
                xlink:href="http://blog.famillecollet.com/pages/Config-en">Les RPM de Remi</link> oder <link
                xlink:href="http://www.jasonlitka.com/category/yum-repo-news">http://www.jasonlitka.com/category/yum-repo-news/</link></para>
              </note>
            </listitem>

            <listitem>
              <para><emphasis role="bold">OpenSuSE</emphasis></para>

              <para>Benutzen Sie yast, um die Pakete "php5", "php5-pear", "php5-xmlrpc", "php5-xsl", "php5-pgsql", "php5-soap",
              "php5-gettext", "php5-pdo", "php5-ldap", "php5-gd" und "apache2-mod_php5" zu installieren. Die CLI ist im php5-Paket
              enthalten.</para>

              <note>
                <para>Zumindest bei SLES10 SP2 fehlt die Funktion hash_hmac.</para>
              </note>

              <para>Alternativ können Sie auch zypper verwenden</para>

              <programlisting> #&gt; zypper install php5 php5-pear php5-xmlrpc php5-xsl php5-mysql php5-soap \
    php5-gettext php5-pdo php5-ldap php5-gd apache2-mod_php5</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </itemizedlist>

      <para>Die Installation von &name-icinga; mit den IDOUtils ist in der <link
      linkend="quickstart-idoutils">Icinga-Schnellstartanleitung</link> bescrieben</para>
    </listitem>

    <listitem>
      <para><emphasis role="bold">Die Installation</emphasis></para>

      <para>Laden Sie das Archiv herunter von <link
      xlink:href="http://sourceforge.net/projects/icinga/files/">http://sourceforge.net/projects/icinga/files/</link>. Falls Sie eine
      Funktion benötigen, die nur in der aktuellen Entwicklerversion vorhanden ist, dann klonen Sie von icinga-web.git:</para>

      <programlisting> #&gt; git clone git://git.icinga.org/icinga-web.git</programlisting>

      <para>Extrahieren Sie das Archiv (tarball) wie folgt:</para>

      <programlisting> #&gt; tar xzvf icinga-web-&ver-icingaweb;.tar.gz</programlisting>

      <para>Wechseln Sie in das Verzeichnis:</para>

      <programlisting> #&gt; cd icinga-web-&ver-icingaweb;</programlisting>

      <para>&name-web; stellt verschiedene configure-Optionen zur Verfügung z.B.</para>

      <programlisting> #&gt; ./configure
               --prefix=/usr/local/icinga-web
               --with-web-user=www-data
               --with-web-group=www-data
               --with-web-path=/icinga-web
               --with-web-apache-path=/etc/apache2/conf.d
               --with-db-type=mysql
               --with-db-host=localhost
               --with-db-port=3306
               --with-db-name=icinga_web
               --with-db-user=icinga_web
               --with-db-pass=icinga_web
               --with-conf-dir=etc/conf.d
               --with-log-folder=log
               --with-api-subtype=TYPE DB driver or network connection
               --with-api-host=HOST Host to connect (DB or other) (default localhost)
               --with-api-port=PORT Port for connection (default 3306)
               --with-api-socket=PATH Path to socket (default none)</programlisting>

      <note>
        <para>Bitte beachten Sie, dass Sie hier die &name-web;-Datenbank konfigurieren, und nicht die Icinga-IDOUtils-Datenbank! User- und
        Gruppenname des Web-Prozesses sind abhängig von der verwendeten Distribution.</para>
      </note>

      <para>Alle Konfigurationsmöglichkeiten sehen Sie mit:</para>

      <programlisting> #&gt; ./configure --help</programlisting>

      <para>Um &name-web; für &name-postgres; zu konfigurieren, führen Sie folgenden Befehl aus:</para>

      <programlisting> #&gt; ./configure --with-db-type=pgsql --with-db-port=5432</programlisting>

      <para>Falls auch &name-icinga; mit pqsql läuft, sind die api-Optionen mit anzugeben:</para>

      <programlisting> #&gt; ./configure --with-db-type=pgsql --with-db-port=5432 \
 --with-api-subtype=pgsql --with-api-port=5432</programlisting>

      <para>Ohne weitere Optionen wird das &name-icingaweb; mit:</para>

      <programlisting> #&gt; ./configure
 #&gt; make install</programlisting>

      <para>unter <filename>/usr/local/icinga-web</filename> installiert. Das kann eine Weile dauern, also bitte nicht ungeduldig werden
      ;-)</para>

      <para>Installation der neuen Apache-Konfiguration</para>

      <programlisting> #&gt; make install-apache-config</programlisting>

      <para>Wenn Sie das nicht möchten, können Sie das bisherige Verfahren nutzen, durch die Eingabe von:</para>

      <programlisting> #&gt; make install-javascript</programlisting>

      <para>Dies installiert die bisherigen Symlinks.</para>

      <para>Erzeugen des Installationsberichtes:</para>

      <para><programlisting> #&gt; make install-done

 Installation of icinga-web succeeded.
 Please check the new Apache2 configuration (etc/apache2/icinga-web.conf).</programlisting></para>

      <para>Passwort zurücksetzen:</para>

      <programlisting> #&gt; make icinga-reset-password</programlisting>

      <para>Setzt das Passwort für jeden Account auf icinga-web zurück.</para>
    </listitem>

    <listitem>
      <para><emphasis role="bold">PHP-Abhängigkeiten</emphasis></para>

      <para>Bitte prüfen Sie die PHP-Abhängigkeiten mit:</para>

      <programlisting> #&gt; make testdeps</programlisting>

      <para>Alle "require"-Tests sollten erfolgreich sein. Eventuell müssen Sie die <filename>php.ini</filename> anpassen:</para>

      <para>Die "magic_quote_gpc" in der Apache- und der CLI-<filename>php.ini</filename> auf "Off" setzen! Evtl. müssen Sie auch
      "safe_mode" auf "off" setzen (PHP &lt; 5.3.0). Bitte beachten Sie, dass die Pfade von der Distribution abhängig sind.</para>

      <programlisting> #&gt; vi /etc/php5/apache/php.ini
   magic_quotes_gpc = off
   safe_mode = off
 #&gt; vi /etc/php5/cli/php.ini
   magic_quotes_gpc = off</programlisting>

      <note>
        <para>Beide Dateien müssen vorhanden sein, sonst erhalten Sie eine Agavi-Meldung, weil der Default von magic_quotes_gpc "ON"
        ist.</para>
      </note>
    </listitem>

    <listitem>
      <para><emphasis role="bold">Datenbank-Installation</emphasis></para>

      <para>&name-web; benötigt eine eigene Datenbank, z.B. icinga_web. Sie können die Datenbank von &name-idoutils; mitverwenden, dies wird
      allerdings nicht empfohlen, um bei Upgrades keine Probleme zu haben.</para>

      <para><emphasis role="bold">Anlegen des Datenbankbenutzers:</emphasis></para>

      <para>Der Benutzer muss mindestens diese Privilegien haben: SELECT, UPDATE, INSERT, DELETE.</para>

      <programlisting> SQL&gt; GRANT USAGE ON *.* TO 'icinga_web'@'localhost' IDENTIFIED BY 'icinga_web';

 SQL&gt; GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, ALTER, INDEX
     ON icinga_web.* TO 'icinga_web'@'localhost';</programlisting>

      <itemizedlist>
        <listitem>
          <para><emphasis role="bold">&name-mysql;</emphasis></para>

          <programlisting> #&gt; mysql -u root -p

 mysql&gt; GRANT USAGE ON icinga_web.* TO 'icinga_web'@'localhost'
        IDENTIFIED BY 'icinga_web'
        WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0;

        GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, ALTER, INDEX
        ON icinga_web.* TO 'icinga_web'@'localhost';

        FLUSH PRIVILEGES;

        quit</programlisting>
        </listitem>

        <listitem>
          <para><emphasis role="bold">&name-postgres;</emphasis></para>

          <programlisting> #&gt; su - postgres

 $ psql

 postgres=# CREATE USER icinga_web;

 postgres=# ALTER USER icinga_web WITH PASSWORD 'icinga_web' CREATEDB;

 &lt;Ctrl&gt;+&lt;D&gt;</programlisting>
        </listitem>
      </itemizedlist>

      <para><emphasis role="bold">Anlegen der Datenbank</emphasis></para>

      <para>&name-web; bringt Doctrine mit, womit in Zukunft die Datenbank verwaltet wird. Mittels 'make' kann diese initialisiert oder
      gelöscht werden.</para>

      <programlisting> #&gt; make db-initialize      - legt eine Icinga Web Datenbank an
                            - und füllt diese mit initialen Werten</programlisting>

      <programlisting> #&gt; make db-drop            - löscht die komplette Datenbank, inklusive
                            - Security-Abfrage, um ungewolltes Löschen zu verhindern</programlisting>

      <para>Um die Datenbankanlege-Befehle nutzen zu können, müssen Sie dem Benutzer, der diese DB-Befehle ausführen soll, auch die
      entsprechenden Privilegien zuordnen. Falls derjenige Benutzer, der für das Icinga-Web in <filename>configure</filename> vorgesehen
      wurde, zu wenig Berechtigungen hat, gibt es in 'make' eine Abfrage, ob Sie einen anderen Benutzer mit mehr Privilegien verwenden
      wollen. Falls dies nicht funktioniert, sollten Sie <filename>etc/build.properties</filename> editieren und einen root-Benutzer
      einfügen.</para>

      <para>Das Installieren der Datenbank funktioniert mittels:</para>

      <programlisting> #&gt; make db-initialize</programlisting>

      <para><emphasis role="bold">Manuelles Anlegen der Datenbank</emphasis></para>

      <para>Sofern Sie die Datenbank manuell installieren wollen, z.B. für Package building, so finden Sie unter
      &lt;/path/to/icinga-web/etc/schema/&gt; das zu importierende SQL-Script.</para>

      <para><emphasis role="bold">MySQL</emphasis><programlisting> $ mysql -u root -p icinga_web  &lt; /path/to/icinga-web/etc/schema/mysql.sql</programlisting></para>
      <para><emphasis role="bold">Oracle</emphasis>

          <programlisting> #&gt; su - oracle
 $ sqlplus dbuser/dbpass
 SQL&gt; @oracle.sql</programlisting>
        </para> 
<para><emphasis role="bold">Postgresql</emphasis> <programlisting> #&gt; su - postgres
 $ psql -U icinga_web -d icinga_web &lt; /path/to/icinga-web/etc/schema/pgsql.sql</programlisting></para>

      <para>Bitte editieren Sie außerdem die Datei <filename>pg_hba.conf</filename> und tragen Sie die folgenden Zeilen ein:</para>

      <programlisting> #&gt; vi /etc/postgresql/9.x/main/pg_hba.conf

 # database administrative login by UNIX sockets
 local all postgres ident

 # TYPE DATABASE USER CIDR-ADDRESS METHOD
 #icinga_web
 local icinga_web icinga_web trust

 # "local" is for Unix domain socket connections only
 local all all trust

 # IPv4 local connections
 host all all 127.0.0.1/32 trust

 # IPV6 local connections
 host all all ::1/128 trust</programlisting>

      <para>Denken Sie anschließend daran, &name-postgres; neu zu laden:</para>

      <programlisting> #&gt; /etc/init.d/postgresql reload</programlisting>
    </listitem>

    <listitem>
      <para><emphasis role="bold">Icinga-Web-Konfiguration</emphasis></para>

      <para>Im Normalfall können Sie die Datenbankeinstellungen während <filename>configure</filename> vornehmen. Sollten Sie diese
      allerdings anpassen oder im Fehlerfall kontrollieren wollen, öffnen Sie folgende Datei mit einem Editor Ihrer Wahl.</para>

      <note>
        <para>Möglicherweise finden Sie es einfacher, beim Editieren von XML-Strukturen Syntax-Hightlighting zu benutzen, um zwischen
        Kommentaren und XML-Tags zu unterscheiden.</para>

        <para>Editieren Sie <filename>/etc/vim/vimrc</filename> <screen> " Vim5 and later versions support syntax highlighting. Uncommenting the next
 " line enables syntax highlighting by default.
 syntax on</screen> oder <filename>/etc/nanorc</filename><screen> ## HTML
 include "/usr/share/nano/html.nanorc"</screen></para>
      </note>

      <programlisting> #&gt; vi app/config/databases.xml</programlisting>

      <note>
        <para>Optional: Ihre spezifischen &name-icinga; Datenbankeinstellungen können Sie vornehmen in
        <filename>etc/conf.d/database.xml</filename> (oder dem web-conf-folder Ziel). Es gibt zwei Datenbanken: icinga_web (welche für die
        interne Verwaltung von icinga_web verwendet wird) und icinga, welche auf die Datenbank zeigt, in die ido2db schreibt. Diese
        Informationen bleiben während eines Update-Prozesses erhalten.</para>
      </note>

      <para><programlisting>   &lt;databases default="icinga_web"&gt;
      &lt;database name="icinga_web" class="AgaviDoctrineDatabase"&gt;

         &lt;!--
            Doctrine dsn strings:

            http://www.doctrine-project.org/documentation/manual/1_1/en/introduction-to-connections
         --&gt;
         &lt;!-- ##### &name-mysql; ##### --&gt;
         &lt;ae:parameter name="dsn"&gt;mysql://icinga_web:icinga_web@127.0.0.1:3306/icinga_web&lt;/ae:parameter&gt;
         &lt;!-- ##### &name-postgres; ##### --&gt;
         &lt;ae:parameter name="dsn"&gt;pgsql://icinga_web:icinga_web@localhost:5432/icinga_web&lt;/ae:parameter&gt;

         &lt;!-- Generic credentials  --&gt;
         &lt;!-- &lt;ae:parameter name="username"&gt;icinga_web&lt;/ae:parameter&gt; --&gt;
         &lt;!-- &lt;ae:parameter name="password"&gt;icinga_web&lt;/ae:parameter&gt; --&gt;

         &lt;!-- DB encoding type --&gt;
         &lt;ae:parameter name="charset"&gt;utf8&lt;/ae:parameter&gt;

         &lt;!--
            Doctrine_Manager configuration
         --&gt;
         &lt;ae:parameter name="manager_attributes"&gt;
            &lt;!-- This allows lazy loading of the models --&gt;
            &lt;ae:parameter name="Doctrine_Core::ATTR_MODEL_LOADING"&gt;CONSERVATIVE&lt;/ae:parameter&gt;
         &lt;/ae:parameter&gt;

         &lt;!-- The path to our models --&gt;
         &lt;ae:parameter name="load_models"&gt;%core.module_dir%/AppKit/lib/database/models/generated&lt;/ae:parameter&gt;
         &lt;ae:parameter name="models_directory"&gt;%core.module_dir%/AppKit/lib/database/models&lt;/ae:parameter&gt;

      &lt;/database&gt;

      &lt;-- Die Icinga Datenbank für ido2db --&gt;
      &lt;database name="icinga" class="AgaviDoctrineDatabase"&gt;

         &lt;!--
            Doctrine dsn strings:

            http://www.doctrine-project.org/documentation/manual/1_1/en/introduction-to-connections
         --&gt;
         &lt;!-- ##### &name-mysql; ##### --&gt;
         &lt;ae:parameter name="dsn"&gt;mysql://icinga:icinga@127.0.0.1:3306/icinga&lt;/ae:parameter&gt;
         &lt;!-- ##### &name-postgres; ##### --&gt;
         &lt;ae:parameter name="dsn"&gt;pgsql://icinga:icinga@localhost:5432/icinga&lt;/ae:parameter&gt;

         &lt;!-- Generic credentials  --&gt;
         &lt;!-- &lt;ae:parameter name="username"&gt;icinga&lt;/ae:parameter&gt; --&gt;
         &lt;!-- &lt;ae:parameter name="password"&gt;icinga&lt;/ae:parameter&gt; --&gt;

         &lt;!-- DB encoding type --&gt;
         &lt;ae:parameter name="charset"&gt;utf8&lt;/ae:parameter&gt;

         &lt;!--
            Doctrine_Manager configuration
         --&gt;
         &lt;ae:parameter name="manager_attributes"&gt;
            &lt;!-- This allows lazy loading of the models --&gt;
            &lt;ae:parameter name="Doctrine_Core::ATTR_MODEL_LOADING"&gt;CONSERVATIVE&lt;/ae:parameter&gt;
         &lt;/ae:parameter&gt;

         &lt;!-- The path to our models --&gt;
         &lt;ae:parameter name="load_models"&gt;%core.module_dir%/Api/lib/database/models/generated&lt;/ae:parameter&gt;
         &lt;ae:parameter name="models_directory"&gt;%core.module_dir%/Api/lib/database/models&lt;/ae:parameter&gt;

      &lt;/database&gt;
   &lt;/databases&gt;
      </programlisting></para>

      <para>In der <filename>access.xml</filename> können Sie die Informationen zu Ihrer command-pipe, den Zugangsdaten und der
      Zugriffmethode (ssh oder via local console) angeben. Außerdem legen Sie fest, welche Icinga-Instanz welchem Host zugeordnet
      ist.</para>

      <programlisting>
        &lt;!-- Map your instances to hosts here --&gt;
        &lt;instances&gt;
            &lt;instance name="default"&gt;localhost&lt;/instance&gt;
        &lt;/instances&gt;
        &lt;!-- default location of the icinga pipe --&gt;
        &lt;defaults&gt;
            &lt;access&gt;
                &lt;write&gt;
                    &lt;files&gt;
                        &lt;resource name="icinga_pipe"&gt;/usr/local/icinga/var/rw/icinga.cmd&lt;/resource&gt;
                    &lt;/files&gt;
                &lt;/write&gt;
            &lt;/access&gt;
        &lt;/defaults&gt;

        &lt;!-- Hosts that can be accessed via the console interface --&gt;
        &lt;hosts&gt;
            &lt;host name="localhost"&gt;
                &lt;type&gt;local&lt;/type&gt;
                &lt;access useDefaults="true"&gt;

                &lt;/access&gt;
            &lt;/host&gt;

            &lt;!--  Example for ssh connection with user/password auth --&gt;
            &lt;host name="remot_host"&gt;
                &lt;type&gt;ssh&lt;/type&gt;
                &lt;ssh-config&gt;
                    &lt;host&gt;localhost&lt;/host&gt;
                    &lt;port&gt;22&lt;/port&gt;
                    &lt;auth&gt;
                        &lt;type&gt;password&lt;/type&gt;
                        &lt;user&gt;john&lt;/user&gt;
                        &lt;password&gt;doe&lt;/password&gt;
                    &lt;/auth&gt;
                &lt;/ssh-config&gt;

                &lt;access useDefaults="true" /&gt;

            &lt;/host&gt;
      &lt;/hosts&gt;
      </programlisting>

      <note>
        <para>Nachdem Sie Änderungen an diesen Konfigurationen vorgenommen haben, müssen Sie den Cache leeren!</para>
      </note>

      <programlisting> #&gt; rm -rf app/cache/config/*.php</programlisting>

      <para>oder /path/to/clearcache.sh</para>

      <programlisting> #&gt; /usr/local/icinga-web/bin/clearcache.sh</programlisting>
    </listitem>

    <listitem>
      <para><emphasis role="bold">Apache-Konfiguration</emphasis></para>

      <para>Voraussetzungen:</para>

      <itemizedlist>
        <listitem>
          <para>mod_rewrite, vielleicht müssen Sie einen Verweis erstellen:</para>

          <para><programlisting> #&gt; ln -s /etc/apache2/mods-available/rewrite.load /etc/apache2/mods-enabled/rewrite.load</programlisting></para>

          <para>Bei OpenSuSE und SLES können Sie das Modul mit "a2enmod rewrite" aktivieren. Falls das nicht funktioniert, gibt es in der
          Datei <filename>/etc/sysconfig/apache2</filename> die Zeile "APACHE_MODULES=...", der das Modul "rewrite" hinzugefügt werden
          muss.</para>

          <para>Bei Debian und Ubuntu können Sie das Modul ebenfalls mit "a2enmod rewrite" aktivieren.</para>

          <para>Bei RHEL/Fedora/CentOS ist die Unterstützung bereits im httpd enthalten.</para>
        </listitem>

        <listitem>
          <para>Über htaccess aktivierte Einstellungen</para>

          <para>Editieren Sie die <filename>.htaccess</filename> unter <filename>/usr/local/icinga-web/pub</filename> und ändern Sie die
          RewriteBase (ab Zeile 14): <programlisting> DirectoryIndex index.php

 Options -MultiViews -Indexes +FollowSymLinks
 Order allow,deny
 Allow from all

 &lt;IfModule mod_rewrite.c&gt;
    RewriteEngine On

    # This depends on your path
    # on independent hosts the base is '/'
    RewriteBase /icinga-web/

        # If the requested URL does not exist (it's likely an agavi route),
        # pass it as path info to index.php, the Agavi dispatch script.
        RewriteRule ^$ index.php?/ [QSA,L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule (.*) index.php?/$1 [QSA,L]
 &lt;/IfModule&gt;

 &lt;IfModule mod_deflate.c&gt;
        SetOutputFilter DEFLATE

        BrowserMatch ^Mozilla/4 gzip-only-text/html
        BrowserMatch ^Mozilla/4\.0[678] no-gzip

        BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
        BrowserMatch \bMSI[E] !no-gzip !gzip-only-text/html

        Header append Vary User-Agent env=!dont-vary
 &lt;/IfModule&gt;

 &lt;IfDefine APACHE2&gt;
        AcceptPathInf  On
 &lt;/IfDefine&gt;

 #&lt;IfModule mod_auth_basic.c&gt;
 #       AuthType Basic
 #       AuthName "My http basic auth realm"
 #       AuthUserFile /path/to/my/htusers
 #       require valid-user
 #&lt;/IfModule&gt;</programlisting></para>
        </listitem>
      </itemizedlist>

      <para>Bitte wechseln Sie in das Konfigurationsverzeichnis Ihres Webservers. Überprüfen Sie, ob die mit <emphasis role="bold">make
      install-apache-config</emphasis> erstellte Konfiguration Ihren Anforderungen entspricht, oder erstellen Sie noch einen neuen Alias im
      Konfigurationsverzeichnis des Webservers (hier in der <filename>icinga-web.conf</filename>):</para>

      <para><programlisting>#&gt; vi /etc/apache2/conf.d/icinga-web.conf
#
# icinga-web apache configuration
# - Enable all options .htaccess
# - Add extjs library to alias
#

Alias /icinga-web/js/ext3 /usr/local/icinga-web/lib/ext3
Alias /icinga-web /usr/local/icinga-web/pub
&lt;Directory /usr/local/icinga-web/lib/ext3&gt;
    Order allow,deny
    Allow from all
&lt;/Directory&gt;
   Alias /icinga-web /usr/local/icinga-web/pub
  &lt;Directory /usr/local/icinga-web/pub&gt;
        AllowOverride All
  &lt;/Directory&gt;</programlisting></para>

      <para>Leeren Sie den Cache:</para>

      <para><programlisting> #&gt; rm /usr/local/icinga-web/app/cache/config/*.php</programlisting></para>

      <para>oder /path/to/clearcache.sh</para>

      <programlisting> #&gt; /usr/local/icinga-web/bin/clearcache.sh</programlisting>

      <para>und starten Sie den Webserver neu:</para>

      <para><programlisting> #&gt; service apache2 restart</programlisting></para>

      <para>bzw.</para>

      <para><programlisting> #&gt; /etc/init.d/apache2 restart</programlisting></para>

      <para>oder</para>

      <programlisting> #&gt; /etc/init.d/httpd restart</programlisting>
    </listitem>

    <listitem>
      <para><emphasis role="bold">Testen</emphasis></para>

      <note>
        <para>Bitte achten Sie darauf, dass Ihre Datenbank, Apache, &name-idoutils; und &name-icinga; gestartet sind!</para>
      </note>

      <para>Öffnen Sie im Webbrowser http://localhost/icinga-web. Überprüfen Sie, ob das Webinterface ohne Fehler ("exceptions") startet,
      und loggen Sie sich mit dem User 'root' und dem Passwort 'password' ein.</para>

      <para>Viel Spaß :-)</para>
    </listitem>

    <listitem>
      <para><anchor xml:id="icinga-web-scratch-errors"/> <emphasis role="bold">Test &amp; Fehler?</emphasis></para>

      <para><note>
          <para>Der folgende Abschnitt versucht, einige Hinweise zu üblichen Problemen zu geben, aber aufgrund der Natur von "geschriebenem"
          Material wird die <link xlink:href="https://wiki.icinga.org/display/testing/Icinga+Web+Testing">Wiki-Seite</link>
          höchstwahrscheinlich aktueller sein, so dass es dort ggf. eine Lösung gibt, die Sie hier nicht finden.</para>
        </note>Diese Sammlung enthält einige nützliche Informationen, wie Sie Fehler finden und lösen können. Ebenso wird darauf
      hingewiesen, welche Informationen Sie im Fehlerfall angeben sollten, wenn Sie eine Frage auf den Mailinglisten oder auf <link
      xlink:href="http://www.icinga-portal.org">http://www.icinga-portal.org</link> stellen.</para>

      <itemizedlist>
        <listitem>
          <para>Geben Sie immer die verwendete Version an - Paket, tar.gz oder GIT?</para>
        </listitem>

        <listitem>
          <para>Browser, Version</para>
        </listitem>

        <listitem>
          <para>Falls das Problem mit der Datenquelle besteht: Ausführliche Informationen zu API, IDOUtils, Core (Version, Debug
          Logs).</para>
        </listitem>
      </itemizedlist>

      <para>Wo können Sie nachsehen?</para>

      <itemizedlist>
        <listitem>
          <para>Apache Error Logs, PHP Errors, PHP Dateien können nicht gefunden werden</para>
        </listitem>

        <listitem>
          <para><filename>/var/log/messages</filename>, /path/to/icinga/var/icinga.log</para>
        </listitem>
      </itemizedlist>

      <para>Änderungen an der &name-web;-Konfiguration (z.B. API/IDOUtils-Einstellungen geändert) werden nicht aktualisiert?</para>

      <itemizedlist>
        <listitem>
          <para>Löschen Sie den Konfigurationscache in app/cache/config/*.php</para>
        </listitem>
      </itemizedlist>

      <programlisting> /usr/local/icinga-web/bin/clearcache.sh</programlisting>

      <para>Icinga-Web zeigt eine leere Seite?</para>

      <itemizedlist>
        <listitem>
          <para>Apache Errors Logs =&gt; mod_rewrite enabled, PHP-Abhängigkeiten ok? 'make testdeps'. Bei Debian gibt es u.a. die folgende
          Fehlermeldung: ".htaccess: Invalid command 'RewriteEngine', perhaps misspelled or defined by a module not included in the server
          configuration"</para>
        </listitem>
      </itemizedlist>

      <para>Icinga Web - Login erfolgt- aber die Seite lädt und lädt...</para>

      <itemizedlist>
        <listitem>
          <para>Request failed, Ressource /icinga-web/appkit/ext/application State could not be loaded - is the url correct? =&gt;
          mod_rewrite enabled ?</para>
        </listitem>

        <listitem>
          <para>.htaccess/VHost-Konfiguration =&gt; Pfade nicht korrekt? Icinga-Web zeigt keine Daten?</para>
        </listitem>

        <listitem>
          <para>Datenbankzugriff verweigert =&gt; Überprüfen Sie, ob die Datenbankeinstellungen für &name-web; korrekt sind.</para>
        </listitem>
      </itemizedlist>

      <para>IDOUtils-Datenbank wird nicht gefüllt?</para>

      <itemizedlist>
        <listitem>
          <para>"Error writing to data sink" =&gt; Überprüfen Sie die IDOUtils (ido2db läuft 2x - ok?), ido2db.cfg debug_level=-1,
          debug_verbosity=2, restarten Sie IDOUtils und suchen Sie Fehler in <filename>ido2db.debug</filename></para>
        </listitem>

        <listitem>
          <para>Keine Daten vorhanden =&gt; Überprüfen Sie <filename>icinga.log</filename>, ob IDOMOD zu Beginn geladen wird. Falls nicht,
          aktivieren Sie das Event Broker Modul in <filename>icinga.cfg</filename> so wie im Icinga Core im <link
          linkend="quickstart-idoutils">IDOUtils Quickstart Guide</link> beschrieben.</para>
        </listitem>

        <listitem>
          <para>IDOUtils DB-Schema ist die aktuellste Version? =&gt; Falls nicht, überprüfen Sie mögliche Upgrades anhand der Docs
          dafür.</para>
        </listitem>

        <listitem>
          <para>Sockets sind korrekt definiert? =&gt; Unix oder TCP Socket, TCP wahlweise mit oder ohne SSL</para>
        </listitem>
      </itemizedlist>

      <para><emphasis role="bold">Testing the Web (stellen Sie sicher, dass PHPUnit installiert ist): </emphasis></para>

      <para><programlisting> $&gt; make test</programlisting></para>

      <note>
        <para>Falls Sie Ihren root-Benutzer zum Testen benutzen, dann stellen Sie vorher sicher, dass für den angegebenen Web-Benutzer in
        der <filename>/etc/passwd</filename> eine gültige Shell eingetragen ist. Anderenfalls werden verschiedene Tests fehlschlagen.
        Abhängig von der verwendeten Icinga-Web-Version kann es sein, dass die Berechtigungen für die Dateien in
        <filename>/usr/local/icinga-web/log</filename> falsch gesetzt sind, so dass Icinga-Web mit der Meldung "Loading"
        stehenbleibt.</para>
      </note>

      <note>
        <para>Nicht vergessen - Ändern von PHP-Einstellungen in der <filename>php.ini</filename> erfordert einen Apache
        reload/restart!</para>
      </note>

      <itemizedlist>
        <listitem>
          <para>PHP Fatal error: Allowed memory size of ... bytes exhausted (tried to allocate ... bytes) =&gt; Überprüfen Sie Ihre
          <filename>php.ini</filename> (apache2 und cli) und setzen Sie den Wert memory_limit auf 128M oder höher</para>
        </listitem>

        <listitem>
          <para>PHP Fatal error: Uncaught exception 'AgaviCacheException' with message 'Failed to write cache file
          /usr/local/icinga-web/app/cache/config/config_handlers.xml_development__xxxx.php" generated from configuration file
          /usr/local/icinga-web/app/config/config_handlers.xml". Please make sure you have set correct write permissions for directory
          /usr/local/icinga-web/app/cache.... =&gt; Setzen von safe_mode = off in /etc/php5/apache/php.ini.</para>

          <note>
            <para>Das kann auch ein Hinweis auf ein aktiviertes SELinux sein.</para>
          </note>
        </listitem>

        <listitem>
          <para>[PHP Error] strtotime(): It is not safe to rely on the system's timezone settings. You are *required* to use the
          date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting
          this warning, you most likely misspelled the timezone identifier. We selected 'Europe/Berlin' for 'CEST/2.0/DST' instead [line
          1548 of /home/xxx/icinga/icinga-web/lib/doctrine/lib/Doctrine/Record.php] =&gt; Sie müssen date.timezone in der
          <filename>php.ini</filename> definieren.</para>
        </listitem>

        <listitem>
          <para>-&gt; 500 internal server error! Uncaught exception AgaviException thrown! Your default timezone is 'System/Localtime', ...
          = &gt; Sie müssen date.timezone in der <filename>php.ini</filename> definieren.</para>
        </listitem>

        <listitem>
          <para>Keine Verbindung zur API. The API Connector returned the following message: getConnection failed: Database connection
          failed: SQLSTATE[28000] [1045] Access denied for user 'icinga'@'localhost' (using password: YES)) =&gt; Überprüfen Sie Ihre
          IDOUtils DB-Referenzen in der <filename>ido2db.cfg</filename> und fügen Sie diese in Ihre &name-web;-Konfiguration als bevorzugte
          DB-Referenzen für Ihre IDO hinzu (siehe Konfiguration der &name-api;). Ab &name-web;1.0.3 können die Werte direkt während des
          configure gesetzt werden.</para>
        </listitem>

        <listitem>
          <para>touch: cannot touch `/usr/local/icinga-web/.../cache/testfile.txt': Permission denied =&gt; Die Konfiguration in den
          xml-Dateien wird vom Framework ge-'pre-cached'. Daher müssen spezielle Berechtigungen für die Caching-Verzeichnisse gesetzt
          werden. Durch die Ausführung von icingaWebTesting.php in etc/tests können die richtigen Berechtigungen automatisch gesetzt
          werden.</para>
        </listitem>

        <listitem>
          <para>PHP Fatal error: Uncaught exception '...' with message 'Couldn't locate driver named mysql' =&gt; Stellen Sie sicher, dass
          php pdo installiert und geladen ist, auch wenn testdeps sagt, dass alles in Ordnung ist.</para>
        </listitem>

        <listitem>
          <para>Das Login wird nicht angezeigt =&gt; Aktivieren Sie short_open_tag in Ihrer <filename>php.ini</filename>. =&gt; Editieren
          Sie open_basedir in Ihrer <filename>php.ini</filename> und fügen Sie die Installationsverzeichnisse von &name-web; und von
          &name-api; (z.B. <filename>/usr/local/icinga/share/</filename>) hinzu.</para>
        </listitem>

        <listitem>
          <para>Leeres &name-web;? =&gt; Wenn mod_rewrite aktiviert ist und 'index.php' erscheint in der angefragten URL, dann funktioniert
          das Portal nicht. Entfernen Sie index.php aus Ihrer URL und alles sollte funktionieren</para>
        </listitem>

        <listitem>
          <para>Die Ergebnisse in den Status Cronks passen nicht zu Ihrer Konfiguration? =&gt; Überprüfen Sie in Ihrem Backend, d.h.
          IDOUtils DB, welche Werte für die Status-Tabellen selektiert werden.</para>
        </listitem>

        <listitem>
          <para>Keine Daten in den Cronks ? =&gt; Überprüfen Sie ob alle Berechtigungen korrekt gesetzt sind, insbesondere von log/.
          Weiterhin können Sie die angezeigten Daten in Ihrem Browser debuggen. Ausführliche Informationen dazu finden Sie im Icinga-Wiki
          <uri>https://wiki.icinga.org/display/Dev/Icinga+Web+Testing</uri></para>
        </listitem>
      </itemizedlist>

      <para>Sofern Sie Fragen oder Updates haben, zögern Sie bitte nicht, uns diese mitzuteilen! :-)</para>
    </listitem>
  </orderedlist>

  <indexterm zone="icinga-web-scratch">
    <primary>Webinterface</primary>
  </indexterm>

  <indexterm zone="icinga-web-scratch">
    <primary>Installation des Webinterfaces</primary>
  </indexterm>
</section>
