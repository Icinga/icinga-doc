<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter [
<!ENTITY % all.entities SYSTEM "all-entities.ent">
%all.entities;
]>
<section version="5.0" xml:id="quickstart-idoutils" xmlns="http://docbook.org/ns/docbook"
         xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:svg="http://www.w3.org/2000/svg" xmlns:m="http://www.w3.org/1998/Math/MathML"
         xmlns:html="http://www.w3.org/1999/xhtml" xmlns:db="http://docbook.org/ns/docbook">
  <title>&name-icinga;-Schnellstart mit &name-idoutils;</title>

  <para><emphasis role="bold"><anchor xml:id="introduction_idoutils" />Einführung</emphasis></para>

  <para>Diese Schnellstartanleitung ist dazu gedacht, Ihnen einfache Anweisungen zu liefern, wie Sie &name-icinga; innerhalb von
  20 Minuten aus dem Quellcode installieren und Ihren lokalen Rechner damit überwachen.</para>

  <para>Hier werden keine fortgeschrittenen Installationsoptionen vorgestellt - lediglich die Grundlagen, die für 95% aller
  Benutzer funktionieren, die anfangen wollen.</para>

  <para>Diese Anleitung enthält Anweisungen für drei verschiedene Linux-Distributionen: <link
  xlink:href="http://fedoraproject.org/">&name-fedora;</link>, <link xlink:href="http://www.ubuntu.com/">&name-ubuntu;</link> und
  <link xlink:href="http://www.opensuse.org/">&name-opensuse;</link>. Ähnliche Distributionen werden wahrscheinlich auch
  funktionieren, darunter <link xlink:href="http://www.redhat.com/">&name-redhat;</link>, <link
  xlink:href="http://www.centos.org/">&name-centos;</link>, <link xlink:href="http://www.debian.org/">&name-debian;</link> und
  <link xlink:href="http://www.novell.com/products/server/">&name-sles;</link>.</para>

  <para><emphasis role="bold">Wenn Sie planen, &name-icinga; OHNE &name-idoutils; zu nutzen, dann lesen Sie statt dessen <xref
  linkend="quickstart-icinga" />!</emphasis></para>

  <para><emphasis role="bold">Was dabei herauskommt</emphasis></para>

  <para>Wenn Sie diesen Anweisungen folgen, werden Sie am Ende folgendes haben:</para>

  <itemizedlist>
    <listitem>
      <para>&name-icinga; und die Plugins werden unterhalb von &url-icinga-base; installiert sein</para>
    </listitem>

    <listitem>
      <para>&name-icinga; wird so konfiguriert sein, dass es einige Dinge auf Ihrem lokalen System überwacht (CPU-Auslastung,
      Plattenbelegung, usw.)</para>
    </listitem>

    <listitem>
      <para>Das &name-icinga;-Web-Interface ist erreichbar unter http://localhost/icinga/</para>
    </listitem>

    <listitem>
      <para>Eine Datenbank, die von &name-icinga; mit Hilfe von &name-idoutils; gefüllt wird</para>
    </listitem>
  </itemizedlist>

  <para><emphasis role="bold">Voraussetzungen</emphasis></para>

  <para>Während einiger Teile der Installation benötigen Sie <emphasis role="bold">root </emphasis>-Zugang zu Ihrer
  Maschine.</para>

  <para>&name-idoutils; benutzt die <link xlink:href="http://libdbi.sourceforge.net">libdbi</link> und die libdbi-Treiber für
  verschiedene Datenbanken. Die Development-Libraries werden ebenfalls benötigt. Die folgenden Beispiele zeigen, wie die
  &name-idoutils; mit libdbi für MySQL oder Postgresql installiert werden.</para>

  <para>Stellen Sie sicher, dass die folgenden Pakete installiert sind, bevor Sie fortfahren.</para>

  <itemizedlist>
    <listitem>
      <para>&name-apache;</para>
    </listitem>

    <listitem>
      <para>GCC-Compiler</para>
    </listitem>

    <listitem>
      <para>C/C++ development libraries</para>
    </listitem>

    <listitem>
      <para><link xlink:href="http://www.boutell.com/gd/">&name-gd;</link>-Development-Libraries</para>
    </listitem>

    <listitem>
      <para>libdbi/libdbi-Treiber, eine Datenbank wie z.B. mysql oder postgresql</para>
    </listitem>
  </itemizedlist>

  <para><emphasis role="bold">Neues Feature für die &name-idoutils;: SSL- Verschlüsselung zwischen idomod und
  ido2db</emphasis></para>

  <para>Wenn Sie <emphasis role="bold">SSL-Encryption </emphasis>verwenden möchten, werden zusätzlich die Pakete openssl und
  openssl-devel/libssl-dev benötigt!</para>

  <para><note>
      : SSL muß auch bei allen idomod-Clients enabled werden, sonst gehen Daten verloren!!!
    </note></para>

  <para></para>

  <para>Sie können diese Pakete mit Hilfe der folgenden Befehle installieren (als root oder mit sudo):</para>

  <para><emphasis role="bold">&name-fedora; / &name-redhat; / &name-centos;:</emphasis></para>

  <programlisting> # yum install httpd gcc glibc glibc-common gd gd-devel</programlisting>

  <para><emphasis role="bold">&name-mysql;:</emphasis></para>

  <programlisting> # yum install mysql mysql-server libdbi libdbi-devel libdbi-drivers libdbi-dbd-mysql</programlisting>

  <para><emphasis role="bold">&name-postgres;:</emphasis></para>

  <programlisting> # yum install postgresql postgresql-server libdbi libdbi-devel libdbi-drivers libdbi-dbd-pgsql</programlisting>

  <para><emphasis role="bold">&name-ubuntu;:</emphasis></para>

  <programlisting> # apt-get install apache2 build-essential libgd2-xpm-dev</programlisting>

  <para><emphasis role="bold">&name-mysql;:</emphasis></para>

  <programlisting> # apt-get install mysql mysql-libdbi0 libdbi0-dev libdbd-mysql</programlisting>

  <para><emphasis role="bold">&name-postgres;:</emphasis></para>

  <programlisting> # apt-get install postgresql libdbi0 libdbi0-dev libdbd-pgsql</programlisting>

  <para><emphasis role="bold">&name-opensuse;:</emphasis></para>

  <para>Bitte nutzen Sie yast für die Installation der Pakete</para>

  <para><emphasis role="bold">Benutzerinformationen erstellen</emphasis></para>

  <para>Werden Sie zum root-Benutzer.</para>

  <programlisting> # su -l</programlisting>

  <para>Erstellen Sie ein neues Benutzerkonto <emphasis>icinga</emphasis> und vergeben Sie ein Passwort:</para>

  <programlisting> # /usr/sbin/useradd -m icinga 
 # passwd icinga  </programlisting>

  <para>Bei einigen Distributionen müssen Sie die Gruppe in einem gesonderten Schritt anlegen:</para>

  <programlisting> # /usr/sbin/groupadd icinga</programlisting>

  <para><emphasis role="bold">&name-icinga; und die Plugins herunterladen</emphasis></para>

  <para>Wechseln Sie in Ihr lokales Source-Verzeichnis, z.B. /usr/src</para>

  <programlisting> # cd /usr/src</programlisting>

  <para>Holen Sie den aktuellen icinga-core Snapshot aus dem &name-icinga; GIT <programlisting> # git clone git://git.icinga.org/icinga-core.git</programlisting>
  oder von der <link xlink:href="http://www.icinga.org/">&name-icinga;-Website</link> .</para>

  <para>Vergessen Sie nicht die <link xlink:href="http://www.nagios.org/">Nagios Plugins</link> .</para>

  <para><emphasis role="bold">&name-icinga;</emphasis> und die IDOutils kompilieren und installieren</para>

  <para>Entpacken Sie das &name-icinga;-Archiv (oder wechseln Sie in den GIT Snapshot)</para>

  <programlisting> # cd /usr/src/ 
 # tar xvzf icinga-&ver-icinga;.tar.gz 
 # cd icinga-&ver-icinga;</programlisting>

  <para>Führen Sie das &name-icinga;-configure-Script aus. Durch die Nutzung des --help-Flags erhalten Sie Hilfe zu den
  Optionen.</para>

  <programlisting> # ./configure --enable-idoutils</programlisting>

  <para><emphasis>Mit <emphasis role="bold"> SSL</emphasis>-Encryption:</emphasis></para>

  <para><programlisting># ./configure --enable-idoutils --enable-ssl</programlisting></para>

  <para>Kompilieren Sie den &name-icinga;-Source-Code. Es gibt auch eine extra Option für &name-idoutils; (<emphasis>make
  idoutils</emphasis>), wenn Sie nur dieses Module erneut kompilieren möchten. Um mögliche Optionen zu sehen, rufen Sie lediglich
  "make" auf.</para>

  <programlisting> # make all</programlisting>

  <para>Installieren Sie die Binaries, das Init-Script, Beispiel-Konfigurationsdateien und setzen Sie die Berechtigungen für das
  External-Command-Verzeichnis. <programlisting> # make install 
 # make install-init 
 # make install-config 
 # make install-commandmode 
 # make install-idoutils</programlisting> oder kürzer <programlisting> # make fullinstall</programlisting></para>

  <para>Bitte starten Sie &name-icinga; noch nicht - es gibt noch ein paar Dinge zu tun...</para>

  <para><emphasis role="bold">Anpassen der Konfiguration</emphasis></para>

  <para>Beispiel-Konfigurationsdateien werden durch <programlisting> # make install-config</programlisting>in
  &url-icinga-base;/etc/ installiert.</para>

  <para>Ändern Sie die <emphasis>&url-icinga-base;/etc/objects/contacts.cfg</emphasis>-Konfigurationsdatei mit Ihrem bevorzugten
  Editor und passen die e-Mail-Adresse in der <emphasis>icingaadmin</emphasis>-Kontaktdefinition an, so dass sie die Adresse
  enthält, die im Falle von Alarmen benachrichtigt werden soll.</para>

  <programlisting> # vi &url-icinga-base;/etc/objects/contacts.cfg</programlisting>

  <programlisting> # cd &url-icinga-base;/etc
 # cp idomod.cfg-sample idomod.cfg
 # cp ido2db.cfg-sample ido2db.cfg</programlisting>

  <para>Wenn Sie die idoutils mit ssl compiliert haben, aktivieren Sie ssl in der idomod.cfg und der ido2db.cfg mit:</para>

  <programlisting> # use_ssl=1
 # socket_type=tcp </programlisting>

  <para><note>
      !!! Vergessen Sie nicht alle anderen idomod- Clients auch neu zu kompilieren und auf ssl umzustellen!!!
    </note></para>

  <para>Aktivieren Sie das idomod-Eventbroker-Modul. Editieren Sie &url-icinga-cfg; und suchen Sie nach "broker_module" und
  aktivieren Sie diese Zeile bzw. fügen Sie die folgende Zeile hinzu (passen Sie die Namen an, falls nötig).</para>

  <programlisting> # broker_module=&url-icinga-base;/etc/bin/idomod.o config_file=&url-icinga-base;/etc/idomod.cfg</programlisting>

<para><emphasis role="bold">&name-mysql;:</emphasis></para>

  <para><emphasis>Anlegen von Datenbank, Benutzer und Berechtigungen</emphasis></para>

  <programlisting> # mysql -u root -p
  
 mysql&gt; CREATE DATABASE icinga;
  
 GRANT USAGE ON *.* TO 'icinga'@'localhost' IDENTIFIED BY 'icinga' WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0;
   
 GRANT SELECT , INSERT , UPDATE , DELETE ON icinga.* TO 'icinga'@'localhost';
 
 FLUSH PRIVILEGES ;

 quit</programlisting>

  <para><emphasis role="bold">Konfigurieren von Datenbank und &name-idoutils;</emphasis></para>

  <programlisting> # cd &url-icinga-base;/module/idoutils/db 
 # mysql -u root -p icinga &lt; mysql.sql</programlisting>

  <programlisting> # vi &url-icinga-base;/etc/ido2db.cfg
  
 db_servertype=mysql
 db_port=3306
 db_user=icinga
 db_pass=icinga</programlisting>

  <para><emphasis role="bold">&name-postgres;:</emphasis></para>

  <para><emphasis>Anlegen von Datenbank und Benutzer</emphasis></para>

  <programlisting> # su - postgres
  $psql
  postgres=# CREATE USER icingauser;
  postgres=# ALTER USER icingauser WITH PASSWORD 'icingauser';
  postgres=# CREATE DATABASE icinga;</programlisting>

  <para><emphasis role="bold">&name-debian;:</emphasis></para>

  <programlisting> # vi /etc/postgresql/8.x/main/pg_hba.conf</programlisting>

  <para><emphasis role="bold">&name-fedora; / &name-redhat; / &name-centos;:</emphasis></para>

  <programlisting> # vi /var/lib/pgsql/data/pg_hba.conf</programlisting>

  <para>Editieren Sie die Konfiguration wie folgt (dem lokalen Benutzer muss vertraut werden)</para>

  <programlisting> # icinga
 local icinga icingauser trust</programlisting>

  <para>Neuladen und konfigurieren des Datenbankschemas</para>

  <programlisting> # /etc/init.d/postgresql-8.x reload</programlisting>

  <programlisting> # cd /path/to/icinga-src/module/idoutils/db
 # psql -U icingauser -d icinga &lt; pgsql.sql</programlisting>

  <para>Editieren der DB-Konfigurationsdatei, um die &name-idoutils; anzupassen</para>

  <programlisting> # vi /usr/local/icinga/etc/ido2db.cfg
 db_servertype=pgsql
 db_port=5432
 db_user=icingauser
 db_pass=icingauser</programlisting>

  <para><emphasis role="bold">Konfigurieren des Web-Interface</emphasis></para>

  <para>Installieren Sie die &name-icinga;-Web-Konfigurationsdatei im &name-apache; conf.d-Verzeichnis.</para>

  <screen> # make install-webconf</screen>

  <para>Legen Sie ein <emphasis>icingaadmin</emphasis>-Konto an, um sich am Web-Interface anmelden zu können. Merken Sie sich das
  Passwort, das Sie diesem Konto geben - Sie brauchen es später.</para>

  <screen> # htpasswd -c &url-icinga-base;/etc/htpasswd.users icingaadmin</screen>

  <note>
    <para>Abhängig von der Apache-Version müssen Sie ggf. <emphasis>htpasswd2 verwenden.</emphasis></para>
   </note>
  <para>Wenn Sie das Passwort später ändern oder einen weiteren Benutzer hinzufügen möchten, verwenden Sie den folgenden
  Befehl:</para>

  <programlisting> # htpasswd &url-icinga-base;/etc/htpasswd.users &lt;USERNAME&gt;</programlisting>

  <para>Starten Sie &name-apache; neu, damit die Änderungen wirksam werden.</para>

  <para><emphasis role="bold">&name-fedora;:</emphasis></para>

  <programlisting> # service httpd restart</programlisting>

  <para><emphasis role="bold">&name-ubuntu; / &name-opensuse;:</emphasis></para>

  <programlisting> # /etc/init.d/apache2 reload</programlisting>

  <para><note>
      Prüfen Sie die Implementierung der verbesserten CGI-Sicherheitsmaßnahmen wie 

      <link linkend="cgisecurity">hier</link>

       beschrieben, um sicherzustellen, dass Ihre Web-Authentifizierungsinformationen nicht kompromittiert werden.
    </note></para>

  <para><emphasis role="bold">Kompilieren und installieren der &name-nagios;-Plugins</emphasis></para>

  <para>Entpacken Sie die &name-nagios;-Plugins-Quellcode-Archivdatei.</para>

  <screen> # cd /usr/src
 # tar xzf nagios-plugins-&ver-nagiosplug;.tar.gz
 # cd nagios-plugins-&ver-nagiosplug;</screen>

  <para>Kompilieren und installieren Sie die Plugins.</para>

  <screen> # ./configure --prefix=/usr/local/icinga --with-nagios-user=icinga
 # make
 # make install</screen>

  <para><emphasis role="bold">&name-idoutils; und &name-icinga; starten</emphasis></para>

  <para>&name-idoutils; muss vor &name-icinga; gestartet werden</para>

  <para><emphasis role="bold">&name-idoutils; starten</emphasis></para>

  <programlisting> # /etc/init.d/ido2db start </programlisting>

  <para><emphasis role="bold">&name-idoutils; beenden</emphasis></para>

  <programlisting># /etc/init.d/ido2db stop</programlisting>

  <para><emphasis role="bold">&name-icinga; starten:</emphasis></para>

  <para><emphasis role="bold">Start von &name-icinga;</emphasis></para>

  <para>Überprüfen Sie die &name-icinga;-Beispielkonfigurationsdateien.</para>

  <programlisting> # &url-icinga-bin; -v &url-icinga-cfg;</programlisting>

  <para>Wenn es dabei keine Fehler gibt, starten Sie &name-icinga;.</para>

  <para><emphasis role="bold">&name-fedora; / &name-opensuse;:</emphasis></para>

  <programlisting> # service icinga start</programlisting>

  <para><emphasis role="bold">&name-ubuntu;:</emphasis></para>

  <programlisting> # /etc/init.d/icinga start</programlisting>

  <para><emphasis role="bold">&name-idoutils; prüfen</emphasis></para>

  <para>Prüfen Sie, ob die Datenbank gefüllt wird</para>

  <programlisting> # mysql -u root -p use icinga;
 mysql&gt; SELECT COUNT(servicecheck_id) AS cnt FROM icinga_servicechecks; 
 quit</programlisting>

  <para><emphasis role="bold">Automatischer Start von &name-icinga;</emphasis></para>

  <para>Fügen Sie &name-icinga; zu der Liste der System-Services hinzu und sorgen Sie für einen automatischen Start, wenn das
  System hochfährt (stellen Sie sicher, dass Sie vorher das Init-Script installiert haben).</para>

  <para><emphasis role="bold">&name-fedora; / &name-opensuse;:</emphasis></para>

  <programlisting> # chkconfig --add icinga 
 # chkconfig icinga on </programlisting>

  <para><emphasis role="bold">&name-ubuntu;:</emphasis></para>

  <programlisting> # ln -s /etc/init.d/icinga /etc/rcS.d/S99icinga</programlisting>

  <screen> # chkconfig --add nagios
 # chkconfig nagios on</screen>

  <para><emphasis role="bold">Anpassen der SE&name-linux;-Einstellungen</emphasis></para>

  <para>&name-fedora; wird mit installiertem SE&name-linux; (Security Enhanced &name-linux;) ausgeliefert und läuft im
  "Enforcing"-Modus. Dies kann zu "Internal Server Error"-Fehlern führen, wenn Sie versuchen, die &name-icinga;-CGIs
  aufzurufen.</para>

  <para>Schauen Sie, ob SE&name-linux; im Enforcing-Modus läuft.</para>

  <screen> # getenforce</screen>

  <para>Setzen Sie SE&name-linux; in den "Permissive"-Modus.</para>

  <screen> # setenforce 0</screen>

  <para>Damit diese Änderung dauerhaft wird, müssen Sie diese Einstellung in <emphasis>/etc/selinux/config</emphasis> anpassen und
  das System neustarten.</para>

  <para>Statt SE&name-linux; zu deaktivieren oder es in den Permissive-Modus zu versetzen, können Sie den folgenden Befehl
  benutzen, um die CGIs im Enforcing/Targeted-Modus laufen zu lassen:</para>

  <screen> # chcon -R -t httpd_sys_content_t &url-icinga-base;/sbin/
 # chcon -R -t httpd_sys_content_t &url-icinga-base;/share/</screen>

  <para>Besuchen Sie das NagiosCommunity.org-Wiki unter <link
  xlink:href="http://www.nagioscommunity.org/wiki">&url-nagios-community;</link>, um Informationen darüber zu erhalten, wie die
  &name-icinga;-CGIs im Enforcing-Modus mit einer Targeted-Richtlinie ausgeführt werden.</para>

  <para><emphasis role="bold">Anmelden am Web-Interface</emphasis></para>

  <para>Sie sollten nun auf das &name-icinga;-Web-Interface zugreifen können. Sie werden nach dem Benutzernamen
  (<emphasis>nagiosadmin</emphasis>) und Passwort gefragt, das Sie vorhin angegeben haben.</para>

  <screen> http://localhost/icinga/</screen>

  <para>oder</para>

  <programlisting> http://yourdomain.com/icinga/</programlisting>

  <para>Klicken Sie auf den "Service Detail"-Verweis in der Navigationsleiste, um Details darüber zu erhalten, was auf Ihrer
  lokalen Maschine überwacht wird. Es wird ein paar Minuten dauern, bis &name-icinga; alle mit Ihrer Maschine verbundenen Services
  geprüft hat, weil die Prüfungen über eine gewisse Zeit verteilt werden.</para>

  <para><emphasis role="bold">Andere Anpassungen:</emphasis></para>

  <para>Stellen Sie sicher, dass die Firewall-Einstellungen Ihrer Maschine einen Zugriff auf das Web-Interface ermöglichen, wenn
  Sie von anderen Rechnern darauf zugreifen wollen.</para>

  <programlisting> # iptables -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT</programlisting>

  <para>Die Konfiguration von e-Mail-Benachrichtigungen ist nicht Gegenstand dieser Anleitung. &name-icinga; ist konfiguriert, um
  e-Mail-Benachrichtigungen zu versenden, aber möglicherweise ist auf Ihrem System noch kein Mail-Programm installiert bzw.
  konfiguriert. Schauen Sie in Ihre Systemdokumentation, suchen Sie im Web oder gucken Sie im <link
  xlink:href="http://www.nagioscommunity.org/wiki"> NagiosCommunity.org-Wiki</link> nach genauen Anweisungen, wie Ihr System
  konfiguriert werden muss, damit es e-Mail-Mitteilungen an externe Adressen versendet. Mehr Informationen zu Benachrichtigungen
  finden Sie <link linkend="notifications">hier</link></para>

  <para><emphasis role="bold">Fertig</emphasis></para>

  <para>Glückwunsch! Sie haben erfolgreich &name-icinga; installiert. Ihre Reise in die Überwachung hat gerade begonnen. Sie
  werden ohne Zweifel mehr als nur Ihre lokale Maschine überwachen wollen, so dass Sie u.a. das folgende <link
  linkend="ch02">Kapitel </link> lesen sollten...</para>
</section>
