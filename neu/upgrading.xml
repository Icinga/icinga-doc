<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE chapter [
  <!ENTITY % all.entities SYSTEM "all-entities.ent">
  %all.entities;
]>
<section version="5.0" xml:id="upgrading" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"
         xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:svg="http://www.w3.org/2000/svg"
         xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:html="http://www.w3.org/1999/xhtml"
         xmlns:db="http://docbook.org/ns/docbook">
    <title>&name-icinga; aktualisieren</title>
    <para>
      <emphasis role="bold">Inhalt</emphasis>
    </para>
    <para>
      <link linkend="upgrading-nagios3x">aktualisieren von früheren &name-icinga; 3.x-Versionen</link>
    </para>
    <para>
      <link linkend="upgrading-nagios2x">aktualisieren von &name-icinga; 2.x</link>
    </para>
    <para>
      <link linkend="upgrading-rpm">aktualisieren einer RPM-Installation</link>
    </para>
    <para>
      <anchor xml:id="upgrading-nagios3x"/>
      <emphasis role="bold">aktualisieren von früheren &name-icinga; 3.x-Versionen</emphasis>
    </para>
    <para>Sobald neuere Alpha-, Beta- oder stabile Versionen von &name-icinga; 3.x herauskommen, sollten Sie dringend über eine Aktualisierung nachdenken. Neuere Ausgaben enthalten Behebungen kritischer Fehler, so dass es wichtig ist, aktuell zu sein. Wenn Sie bereits &name-icinga; wie in den <link linkend="quickstart">Schnellstartanleitungen</link> beschrieben aus dem Quellcode installiert haben, dann können Sie einfach neuere Versionen installieren. Sie müssen dazu noch nicht einmal root-Berechtigungen haben, weil bereits alles passiert ist, was als root-Benutzer getan werden muss. Hier der Aktualisierungsprozess...</para>
    <para>Stellen Sie sicher, dass Sie eine gute Datensicherung Ihrer bestehenden &name-icinga;-Installation und der Konfigurationsdateien haben. Wenn irgendetwas schief geht oder nicht funktioniert, dann können Sie auf diese Weise schnell Ihre alte &name-icinga;-Version wiederherstellen.</para>
    <para>Werden Sie der nagios-Benutzer. &name-debian;/&name-ubuntu;-Benutzer sollten <emphasis>sudo -s nagios</emphasis> benutzen.</para>
    <screen>
su -l nagios
</screen>
    <para>Holen Sie sich das Quellcode-Archiv der letzten &name-icinga;-Version (besuchen Sie <link xlink:href="&url-nagios;/download/">&url-nagios;/download/</link> für den Verweis auf die letzte Version).</para>
    <screen>
wget http://osdn.dl.sourceforge.net/sourceforge/nagios/nagios-<emphasis> 3.x</emphasis>.tar.gz
</screen>
    <para>Entpacken Sie das Quellcode-Archiv.</para>
    <screen>
tar xzf nagios-<emphasis> 3.x</emphasis>.tar.gz
cd nagios-<emphasis> 3.x</emphasis>
</screen>
    <para>Starten Sie das &name-icinga;-configure-Script mit dem Namen der Gruppe mit Berechtigungen für das &quot;external command file&quot;, z.B. so:</para>
    <screen>
./configure --with-command-group=nagcmd
</screen>
    <para>Kompilieren Sie den &name-icinga;-Quellcode.</para>
    <screen>
make all
</screen>
    <para>Installieren Sie aktualisierte Programme, Dokumentation und Web-Interface. Ihre vorhandenen Konfigurationsdaten werden in diesem Schritt nicht überschrieben.</para>
    <screen>
make install
</screen>
    <para>Überprüfen Sie Ihre Konfigurationsdateien und starten Sie &name-icinga; erneut.</para>
    <screen>
&url-icinga-base;/bin/nagios -v &url-icinga-base;/etc/nagios.cfg
/sbin/service nagios restart
</screen>
    <para>Das war&apos;s - Sie sind fertig!</para>
    <para>
      <anchor xml:id="upgrading-nagios2x"/>
      <emphasis role="bold">Aktualisierung von &name-icinga; 2.x</emphasis>
    </para>
    <para>Es sollte nicht allzu schwierig sein, von &name-icinga; 2.x auf &name-icinga; 3.x zu aktualisieren. Die Aktualisierung ist im Wesentlichen die gleiche wie die von bestehenden 3.x-Versionen. Allerdings müssen Sie Ihre Konfigurationsdateien ein wenig ändern, damit sie mit &name-icinga; 3 funktionieren:</para>
    <itemizedlist>
      <listitem>
        <para> Die alte <emphasis>service_reaper_frequency</emphasis>-Variable in der Hauptkonfigurationsdatei wurde umbenannt in <link linkend="configmain-check_result_reaper_frequency">check_result_reaper_frequency</link>.</para>
      </listitem>
      <listitem>
        <para> Das alte <emphasis>$NOTIFICATIONNUMBER$</emphasis>-Makro entfällt zugunsten der <link linkend="macrolist-hostnotificationnumber">$HOSTNOTIFICATIONNUMBER$</link>- und <link linkend="macrolist-servicenotificationnumber">$SERVICENOTIFICATIONNUMBER$</link>-Makros.</para>
      </listitem>
      <listitem>
        <para> Die alte <emphasis>parallelize</emphasis>-Direktive in Service-Definitionen ist veraltet und wird nicht länger benutzt, weil alle Service-Prüfungen parallel ablaufen.</para>
      </listitem>
      <listitem>
        <para> Die alte <emphasis>aggregate_status_updates</emphasis>-Option wurde entfernt. Alle Statusdatei-Aktualisierungen werden nun mit einem minimalen Intervall von einer Sekunde zusammengefasst.</para>
      </listitem>
      <listitem>
        <para> Erweiterte Host- und erweiterte Service-Definitionen sind veraltet. Sie werden noch von &name-icinga; gelesen und verarbeitet, aber es wird empfohlen, dass Sie diese Direktiven in die entsprechenden Host- und Service-Definitionen verschieben.</para>
      </listitem>
      <listitem>
        <para> Die alte <emphasis>downtime_file</emphasis>-Dateivariable in der Hauptkonfigurationsdatei wird nicht länger unterstützt, weil Einträge von geplanten Ausfallzeiten (downtimes) nun in der <link linkend="configmain-state_retention_file">Aufbewahrungsdatei</link> (retention file) gespeichert werden. Um bestehende Einträge zu erhalten, stoppen Sie &name-icinga; 2.x und hängen Sie den Inhalt Ihrer alten Downtime-Datei an das &quot;retention file&quot;.</para>
      </listitem>
      <listitem>
        <para> Die alte <emphasis>comment_file</emphasis>-Dateivariable in der Hauptkonfigurationsdatei wird nicht länger unterstützt, weil Kommentare nun in der <link linkend="configmain-state_retention_file">Aufbewahrungsdatei</link> (retention file) gespeichert werden. Um bestehende Einträge zu erhalten, stoppen Sie &name-icinga; 2.x und hängen Sie den Inhalt Ihrer alten Kommentar-Datei an die &quot;Aufbewahrungsdatei&quot; (retention file).</para>
      </listitem>
    </itemizedlist>
    <para>Stellen Sie außerdem sicher, dass Sie den &quot;<link linkend="whatsnew">Was gibt&apos;s Neues</link>&quot;-Abschnitt in der Dokumentation lesen. Er beschreibt all die Änderungen am &name-icinga; 3-Code, die seit der letzten stabilen &name-icinga; 2.x-Version gemacht wurden. Es wurde einiges geändert, also werfen Sie einen Blick darauf.</para>
    <para>
      <anchor xml:id="upgrading-rpm"/>
      <emphasis role="bold">aktualisieren einer RPM-Installation</emphasis>
    </para>
    <para>Wenn Sie momentan eine RPM- oder &name-debian;/&name-ubuntu;-APT-paketbasierte &name-icinga;-Installation haben und nun den Übergang zu einer Installation aus dem offiziellen Quellcode machen wollen, dann sind hier die grundlegenden Schritte:</para>
    <orderedlist>
      <listitem>
        <para> Sichern Sie Ihre existierende &name-icinga;-Installation</para>
      </listitem>
      <listitem>
        <para>
          <itemizedlist>
            <listitem>
              <para> Konfigurationsdateien</para>
            </listitem>
            <listitem>
              <para>
                <itemizedlist>
                  <listitem>
                    <para> Hauptkonfigurationsdatei (normalerweise <emphasis>nagios.cfg</emphasis>)</para>
                  </listitem>
                  <listitem>
                    <para> Ressource-Konfigurationsdatei (normalerweise <emphasis>resource.cfg</emphasis>)</para>
                  </listitem>
                  <listitem>
                    <para> CGI-Konfigurationsdatei (normalerweise <emphasis>cgi.cfg</emphasis>)</para>
                  </listitem>
                  <listitem>
                    <para> all Ihre Objektdefinitionsdateien</para>
                  </listitem>
                </itemizedlist>
              </para>
            </listitem>
            <listitem>
              <para> Aufbewahrungsdatei (normalerweise <emphasis>retention.dat</emphasis>)</para>
            </listitem>
            <listitem>
              <para> die aktuelle &name-icinga;-Protokolldatei (normalerweise <emphasis>nagios.log</emphasis>)</para>
            </listitem>
            <listitem>
              <para> archivierte &name-icinga;-Protokolldateien</para>
            </listitem>
          </itemizedlist>
        </para>
      </listitem>
      <listitem>
        <para> Deinstallieren Sie die originalen RPM- oder APT-Pakete</para>
      </listitem>
      <listitem>
        <para> Installieren Sie &name-icinga; vom Quellcode, indem Sie der <link linkend="quickstart">Schnellstartanleitung</link> folgen</para>
      </listitem>
      <listitem>
        <para> Sichern Sie Ihre Original-&name-icinga;-Konfigurationsdateien, Aufbewahrungs- und Protokolldateien wieder zurück</para>
      </listitem>
      <listitem>
        <para><link linkend="verifyconfig">Überprüfen</link>  Sie Ihre Konfiguration und <link linkend="startstop">starten</link> Sie &name-icinga;</para>
      </listitem>
    </orderedlist>
    <para>Beachten Sie, dass verschiedene RPM- oder APT-Pakete &name-icinga; auf verschiedene Weisen oder an verschiedenen Orten installieren. Stellen Sie sicher, dass Sie all Ihre kritischen &name-icinga;-Dateien gesichert haben, bevor Sie das Original-RPM- oder APT-Paket entfernen, so dass Sie darauf zurückgreifen können, wenn Sie auf Probleme stoßen.</para>
</section>
